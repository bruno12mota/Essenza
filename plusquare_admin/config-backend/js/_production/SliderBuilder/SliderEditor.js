define(["jquery","./SliderEditorSlide","./SliderEditorElement","ui/ui-elements","ui/elements/OrderableList"],function(b,h,k,m){m=function(a,d,c,e){this.$this=b(a);builderPathGlobal=this.builderPath=d;this.iniValue=b("#content").val();this.mainOptionsIds=c;this.id=e;this.slides=[];this.slides.push(new h);this.currentSlide=0;this.init()};m.prototype={init:function(){var a=this.$this;this.$sliderHolder=a.find(".sliderHolder");this.$background=this.$sliderHolder.find(">.background");this.$tracer=a.find(".tracer");
this.$elements=a.find(".elements");this.$loadingBackground=a.find(".loading");this.elementIsSelected=this.loadingImage=!1;var d=a.find(".menu_top");this.$previousSlide=d.find(".changeSlide.previous").click(b.proxy(this.previousSlide,this));this.$currentSlideInfo=d.find(".info span");this.$nextSlide=d.find(".changeSlide.next").click(b.proxy(this.nextSlide,this));d.find(".menu_btn.add_new").click(b.proxy(this.newSlide,this));d.find(".menu_btn.remove_slide").click(b.proxy(this.removeSlide,this));this.$contents=
a.find(".content");this.$subButtons=a.find(".tc_sub_button");this.$subButtons.eq(1).addClass("inactive");this.$subButtons.eq(2).addClass("inactive");this.currentTab=0;this.$subButtons.click(b.proxy(function(a){a=b(a.target);a.hasClass("inactive")||(this.currentTab=parseInt(a.attr("rel"),10),this.updateTab());return!1},this));this.updateTab();this.$durationInput=b("#duration_input").blur(b.proxy(this.changeSlideDuration,this));this.backgroundType=b("#slide_media_type");this.backgroundType.bind("change",
b.proxy(this.backgroundTypeChanged,this));this.imageBackground=b("#slide_image_id");this.imageBackground.bind("change",b.proxy(this.backgroundChanged,this));this.videoBackgroundType=b("#slide_video_type");this.videoBackgroundType.bind("change",b.proxy(this.backgroundTypeChanged,this));this.videoIdInput=b("#slide_video_id");this.videoThumbInput=b("#slide_video_image").bind("change",b.proxy(this.videoThumbChanged,this));this.videoAutoplayInput=b("#slide_video_autoplay");this.backgroundSlideColor=b("#slide_background_color");
this.backgroundSlideColor.bind("change",b.proxy(this.backgroundColorChanged,this));this.slideThumbnail=b("#slide_thumbnail_id");this.$elementsOverviewHolder=b("#slider_elements_overview_option_main_holder");this.$propertiesAnimationHolder=b("#slide_element_tabs_unb_option_main_holder").hide();this.$elementVerticalSnapping=b("#vertical_snapping");this.$elementHorizontalSnapping=b("#horizontal_snapping");this.$elementMinScale=b("#min_scale");this.$elementMaxScale=b("#max_scale");this.$textPropertiesHolder=
b("#slide_text_properties_option_main_holder").hide();this.$buttonPropertiesHolder=b("#slide_button_properties_option_main_holder").hide();this.$elementsOverviewHolder.find(">.option_label").append(b("<a href='#' onclick='return false;'>Add element</a>").click(b.proxy(this.openElementLightbox,this)));this.$propertiesAnimationHolder.find(">.option_label").append(b("<a href='#' class='back' onclick='return false;'>Back to Overview</a>").click(b.proxy(this.backToOverview,this)));this.$elementsList=b("#slider_elements_overview_orderable_list").bind("itemChanged",
b.proxy(this.elementsOrderChanged,this)).bind("itemRemoved",b.proxy(this.elementListRemoved,this)).bind("properties",b.proxy(this.elementProperties,this)).bind("animation",b.proxy(this.elementAnimation,this));this.$elements.bind("elementSelected",b.proxy(this.elementSelected,this));this.$phasing=b("#slider_element_animation").bind("changePhase",b.proxy(this.changedElementPhase,this));this.$elementTop=b("#slider_element_animation_top").bind("blur",b.proxy(this.changedElementProperty,this));this.$elementLeft=
b("#slider_element_animation_left").bind("blur",b.proxy(this.changedElementProperty,this));this.$elementSize=b("#slider_element_animation_size").bind("blur",b.proxy(this.changedElementProperty,this));this.$elementSizeHolder=b("#slider_element_animation_size_option_main_holder");this.$elementOpacity=b("#slider_element_animation_opacity").bind("blur",b.proxy(this.changedElementProperty,this));this.$elementSnap=b("#slider_element_animation_snap_to").bind("change",b.proxy(this.snapElementTo,this));this.$elementDelay=
b("#slider_element_animation_delay").bind("blur",b.proxy(this.changedElementAnimProperty,this));this.$elementDuration=b("#slider_element_animation_duration").bind("blur",b.proxy(this.changedElementAnimProperty,this));this.$elementType=b("#slider_element_animation_type").bind("change",b.proxy(this.changedElementAnimProperty,this));this.$elementEase=b("#slider_element_animation_ease").bind("change",b.proxy(this.changedElementAnimProperty,this));this.$elementMatchPrevious=b("#element_match_previous").bind("click",
b.proxy(this.matchPrevious,this));this.$elementMatchFollowing=b("#element_match_following").bind("click",b.proxy(this.matchFollowing,this));this.$elementAlignmentSnap=b("#slider_element_animation_alignment").bind("change",b.proxy(this.snapElementAlignmentTo,this));this.$elementText=b("#slider_element_animation_text").bind("blur change",b.proxy(this.changeElementText,this));this.$elementTextHolder=b("#slider_element_animation_text_option_main_holder");b("#element_remove_btn").click(b.proxy(this.removeCurrentElement,
this));this.currentPhase=2;this.kenBurnsInitial=b("#slide_background_position");this.kenBurnsInitial.bind("change",b.proxy(this.kenBurnsInitialChange,this));this.kenBurnsFinal=b("#slide_background_end_position");this.useKenBurns=b("#slide_use_ken_burns");this.kenBurnsDuration=b("#slide_ken_burns_duration");this.background_vertical_snapping=b("#background_vertical_snapping");this.background_horizontal_snapping=b("#background_horizontal_snapping");this.$slidesList=b("#slides_overview_orderable_list").bind("itemChanged",
b.proxy(this.slidesOrderChanged,this)).bind("itemRemoved",b.proxy(this.slideListRemoved,this)).bind("properties",b.proxy(this.goToSlideProperties,this));this.sliderRelHeight=b("#height");this.sliderRelHeight.bind("blur",b.proxy(this.changeHeight,this));this.initialValues();this.changeHeight();b("#post").submit(b.proxy(this.makeHtml,this))},updateTab:function(){this.$contents.css("display","none");this.$subButtons.removeClass("active");this.$contents.eq(this.currentTab).css("display","block");this.$subButtons.eq(this.currentTab).addClass("active")},
changeTab:function(a){this.currentTab=0;this.updateTab()},updateShowingTabs:function(){var a="image"==this.slides[this.currentSlide].parameters.backgroundType&&0<this.$background.find("img").length,b="color"==this.slides[this.currentSlide].parameters.backgroundType;a?this.$subButtons.eq(2).removeClass("inactive"):this.$subButtons.eq(2).addClass("inactive");a||b?this.$subButtons.eq(1).removeClass("inactive"):this.$subButtons.eq(1).addClass("inactive");a||2!=this.currentTab||this.changeTab(0);a||(b||
1!=this.currentTab)||this.changeTab(0)},closeElementLightbox:function(){this.$newElementLightboxCover.stop().fadeTo(300,0,function(){b(this).hide()});this.$newElementLightbox.stop().fadeTo(300,0,function(){b(this).hide()});return!1},submitElementLightbox:function(){var a=this.$newElementLightbox.find("#new_slide_element").val();"text"==a?this.addTextBlock(b("#slide_text_picker_button").clone(!0)):"image"==a?this.addImage(b("#slide_element_id").val()):"button"==a&&this.addButton(b("#slide_button_picker_button").clone(!0));
this.closeElementLightbox();return!1},openElementLightbox:function(){if(void 0==this.$newElementLightbox){var a=b("body");this.$newElementLightboxCover=b('<div id="new_element_cover" class="pq_lightbox_cover" style="display: none;"></div>').appendTo(a);this.$newElementLightbox=b('<div id="new_element_box" class="pq_lightbox" style="display: none;"></div>').appendTo(a);this.$newElementLightbox.append(b('<div class="pq_lightbox_header">Add New Element <a class="close_btn" href="#"></a></div><div class="lightbox_content"><div class="loading">Loading</div></div><div class="pq_lightbox_submit_menu"><a class="ui-button lightbox_submit" href="#">Add Element</a><a class="ui-button close" href="#">Exit</a></div>'));
var d=this.$newElementLightbox.find(".lightbox_content");this.$newElementLightbox.find(".close_btn, .close").click(b.proxy(this.closeElementLightbox,this));this.$newElementLightbox.find(".lightbox_submit").click(b.proxy(this.submitElementLightbox,this));jQuery.post(adminAjax,{action:"pq_get_add_element"},b.proxy(function(a){d.html(a)},this))}a=b(window).scrollTop();this.$newElementLightboxCover.stop().show().fadeTo(500,0.6);this.$newElementLightbox.css("top",40+a+"px").stop().show().fadeTo(500,1);
return!1},updateTracer:function(){if(!this.elementIsSelected)return!1;var a=this.selectedElement.getInstance(this.currentPhase/2);this.$tracer.css({width:a.x+"px",height:a.y+"px"})},elementSelected:function(a,d){this.selectedElement=d;this.elementIsSelected=!0;this.editingElement=d;this.$elements.bind("elementUnselect",b.proxy(this.elementUnselected,this));this.updateShowingTabs();this.$subButtons.eq(1).trigger("click");b(d).bind("changePos",b.proxy(this.changeByElement,this));this.$tracer.css("display",
"inline");this.updateTracer();this.$elementsOverviewHolder.hide();this.$propertiesAnimationHolder.show();this.$elementVerticalSnapping.val(d.parameters.vertical_snapping);this.$elementHorizontalSnapping.val(d.parameters.horizontal_snapping);this.$elementMinScale.val(d.parameters.min_scale);this.$elementMaxScale.val(d.parameters.max_scale);this.$elementVerticalSnapping.trigger("update");this.$elementHorizontalSnapping.trigger("update");this.$elementVerticalSnapping.bind("change",b.proxy(this.updateElementCommons,
this));this.$elementHorizontalSnapping.bind("change",b.proxy(this.updateElementCommons,this));this.$elementMinScale.bind("change",b.proxy(this.updateElementCommons,this));this.$elementMaxScale.bind("change",b.proxy(this.updateElementCommons,this));if("text"==this.selectedElement.type){var c=b("#slide_text_properties");c.val(d.$content.attr("data-values"));c.trigger("update");this.$buttonPropertiesHolder.hide();this.$textPropertiesHolder.show();this.targetCloner=b("#slide_text_properties_button");
c.bind("change",b.proxy(this.updateElementProperties,this))}else"button"==this.selectedElement.type&&(c=b("#slide_button_properties"),c.val(d.$content.attr("data-values")),c.trigger("update"),this.$textPropertiesHolder.hide(),this.$buttonPropertiesHolder.show(),this.targetCloner=b("#slide_button_properties_button"),c.bind("change",b.proxy(this.updateElementProperties,this)));"image"==this.selectedElement.type?(this.$elementTextHolder.css("display","none"),this.$elementSizeHolder.css("display","block"),
this.$textPropertiesHolder.hide(),this.$buttonPropertiesHolder.hide()):(this.$elementTextHolder.css("display","block"),this.$elementText.val(this.selectedElement.$content.text()),this.$elementSizeHolder.css("display","none"));this.changeByElement();this.updateElementsView()},elementUnselected:function(){if(!this.elementIsSelected)return!1;this.changedElementPhase(null,2);this.elementIsSelected=!1;this.selectedElement.unselectElem();this.updateShowingTabs();this.$tracer.css("display","none");this.$phasing.find(".phase").eq(2).trigger("click");
this.$elements.unbind("elementUnselect",this);b("#slide_button_properties, #slide_text_properties").unbind("change");this.updateElementsView()},changeByElement:function(){if(this.elementIsSelected)if(0==this.currentPhase%2){var a=this.selectedElement.getInstance(this.currentPhase/2);this.$elementTop.val(a.y);this.$elementLeft.val(a.x);this.$elementOpacity.val(a.opacity);"image"==this.selectedElement.type&&this.$elementSize.val(a.size);this.updateTracer()}else a=this.selectedElement.getAnimationInstance(Math.floor(this.currentPhase/
2)),this.$elementDelay.val(a.delay),this.$elementDuration.val(a.duration),this.$elementType.val(a.type),this.$elementEase.val(a.ease),this.$elementType.trigger("update"),this.$elementEase.trigger("update")},addElementToList:function(a){this.$elementsList.hasClass("ready")?this.$elementsList.trigger("addItem",[b('<span class="image" style="width: 13px; background-image: url('+builderPathGlobal+"/images/slider_builder/"+a.type+'_element.png);"></span><p class="title">'+("image"==a.type?a.type+" Element":
"&#34;"+a.$content.text()+"&#34; "+a.type+" Element")+'</p><a href="#" data-event="animation" onclick="return false;">Edit animation</a><a href="#" data-event="properties" onclick="return false;">Edit properties</a>'),this.slides[this.currentSlide].elements.length-a.depth-1]):this.$elementsList.bind("bindsReady",b.proxy(function(){this.$elementsList.trigger("addItem",[b('<span class="image" style="width: 13px; background-image: url('+builderPathGlobal+"/images/slider_builder/"+a.type+'_element.png);"></span><p class="title">'+
("image"==a.type?a.type+" Element":"&#34;"+a.$content.text()+"&#34; "+a.type+" Element")+'</p><a href="#" data-event="animation" onclick="return false;">Edit animation</a><a href="#" data-event="properties" onclick="return false;">Edit properties</a>'),this.slides[this.currentSlide].elements.length-a.depth-1])},this))},addTextBlock:function(a){a=new k.TextElement(this.slides[this.currentSlide].elements.length,this.$elements,a);this.slides[this.currentSlide].addElement(a);this.addElementToList(a);
return!1},addButton:function(a){a=new k.ButtonElement(this.slides[this.currentSlide].elements.length,this.$elements,a);this.slides[this.currentSlide].addElement(a);this.addElementToList(a);return!1},loadAttachment:function(a){jQuery.post(adminAjax,{action:"get-attachment",id:a},b.proxy(function(a){if(!0==a.success){var c=b("<img src='"+a.data.url+"' alt='Image element'/>");a=new k.ImageElement(this.slides[this.currentSlide].elements.length,this.$elements,c,a.data.width,a.data.height);this.slides[this.currentSlide].addElement(a);
this.addElementToList(a)}},this))},addImage:function(a){""!=a&&this.loadAttachment(a)},getElementByDepth:function(a){for(var b=this.slides[this.currentSlide].elements,c=0;c<b.length;c++)if(b[c].depth==a)return b[c];return null},elementsOrderChanged:function(a,b,c){a=this.slides[this.currentSlide].elements.length-1;b=a-b;c=a-c;a=this.getElementByDepth(b);var e=this.getElementByDepth(c);a.setDepth(c);e.setDepth(b)},elementListRemoved:function(a,b){var c=this.slides[this.currentSlide].elements.length-
1-b;this.getElementByDepth(c).deleteElement(!1);this.slides[this.currentSlide].removeElement(c)},elementProperties:function(a,d){var c=this.getElementByDepth(this.slides[this.currentSlide].elements.length-1-d);this.editingElement=c;b("#slide_element_tabs_unb_tabs").trigger("change",[0]);c.selectElement()},updateElementProperties:function(){WP_DEBUG&&console.log("Update Props");this.editingElement.updateInsideContent(this.targetCloner.clone(!0));return!1},updateElementCommons:function(){this.editingElement.parameters.vertical_snapping=
this.$elementVerticalSnapping.val();this.editingElement.parameters.horizontal_snapping=this.$elementHorizontalSnapping.val();this.editingElement.parameters.min_scale=this.$elementMinScale.val();this.editingElement.parameters.max_scale=this.$elementMaxScale.val()},elementAnimation:function(a,d){var c=this.getElementByDepth(this.slides[this.currentSlide].elements.length-1-d);this.editingElement=c;b("#slide_element_tabs_unb_tabs").trigger("change",[1]);c.selectElement()},backToOverview:function(){this.elementUnselected()},
updateElementsView:function(){this.elementIsSelected?(this.$elementsOverviewHolder.hide(),this.$propertiesAnimationHolder.show()):(this.$elementsOverviewHolder.show(),this.$propertiesAnimationHolder.hide())},removeCurrentElement:function(){if(!this.elementIsSelected)return!1;this.selectedElement.deleteElement();this.elementUnselected();return!1},matchPrevious:function(){if(!this.elementIsSelected)return!1;this.selectedElement.matchPrevious();return!1},matchFollowing:function(){if(!this.elementIsSelected)return!1;
this.selectedElement.matchFollowing();return!1},changedElementProperty:function(){if(!this.elementIsSelected)return!1;var a=this.$elementTop.val(),b=this.$elementLeft.val(),c=this.$elementOpacity.val(),e=this.$elementSize.val(),a={x:b,y:a,opacity:c,size:e};this.selectedElement.setInstance(Math.round(this.currentPhase/2),a)},changedElementAnimProperty:function(){if(!this.elementIsSelected)return!1;var a=this.$elementDelay.val(),b=this.$elementDuration.val(),c=this.$elementType.val(),e=this.$elementEase.val();
this.selectedElement.setAnimationInstance(Math.floor(this.currentPhase/2),{delay:a,duration:b,type:c,ease:e})},snapElementTo:function(){if(!this.elementIsSelected)return!1;this.selectedElement.snapTo(this.$elementSnap.val())},changedElementPhase:function(a,b){if(!this.elementIsSelected)return!1;this.currentPhase=b;this.$elementMatchPrevious.removeClass("disabled");this.$elementMatchFollowing.removeClass("disabled");0==b&&this.$elementMatchPrevious.addClass("disabled");6==b&&this.$elementMatchFollowing.addClass("disabled");
this.slides[this.currentSlide].changeElementsPhase(Math.round(this.currentPhase/2)+1);this.changeByElement()},changeElementText:function(){if(!this.elementIsSelected)return!1;if("text"==this.selectedElement.type||"button"==this.selectedElement.type){var a=this.$elementText.val();this.selectedElement.setSpecificValues(a)}},changeHeight:function(){var a=900*(parseInt(this.sliderRelHeight.val(),10)/100);this.height=a;this.$sliderHolder.css({height:a+"px"});a=900/a;this.kenBurnsInitial.trigger("ratioChange",
a);this.kenBurnsFinal.trigger("ratioChange",a);for(var a=this.$elements.width(),b=this.$elements.height(),c=this.slides[this.currentSlide].elements,e=0;e<c.length;e++)c[e].elementsWidth=a,c[e].elementsHeight=b,c[e].updatePosition(!1)},kenBurnsInitialChange:function(){var a=this.kenBurnsInitial.val();if(void 0!=a&&""!=a){var b=a.split("/"),a=900/b[2],c=a/(this.currentImageWidth/this.currentImageHeight),e=this.height-c,f=900-a,e=parseFloat(b[0],10)*e,b=parseFloat(b[1],10)*f;this.$background.find("img").css({position:"absolute",
width:a+"px",height:c+"px",top:e+"px",left:b+"px"})}},backgroundTypeChanged:function(){var a=this.backgroundType.val();WP_DEBUG&&console.log("background type change");this.$background.removeClass("youtube").removeClass("vimeo").removeClass("dailymotion");"image"==a?(this.$background.css("background-color",""),this.slides[this.currentSlide].parameters.backgroundType="image",this.updateShowingTabs(),this.backgroundChanged()):"color"==a?(a=this.backgroundSlideColor.val(),this.slides[this.currentSlide].parameters.backgroundType=
"color",this.updateShowingTabs(),this.$background.find("img").css("display","none"),this.$background.css("background-color",a),this.loadingImage=!1,this.$loadingBackground.stop().fadeTo(200,0,function(){b(this).hide()}),this.$slidesList.trigger("changeImage",[this.currentSlide,builderPathGlobal+"/images/slider_builder/colored_slide.png"])):(a=this.videoBackgroundType.val(),this.$background.find("img").css("display","none"),this.$background.css("background-color",""),this.$background.addClass(a),this.slides[this.currentSlide].parameters.backgroundType=
a,this.updateShowingTabs(),this.$slidesList.trigger("changeImage",[this.currentSlide,builderPathGlobal+"/images/slider_builder/video_slide.png"]))},backgroundColorChanged:function(){var a=this.backgroundSlideColor.val();this.$background.css("background-color",a)},videoThumbChanged:function(){""==this.slideThumbnail.val()&&this.slideThumbnail.val(this.videoThumbInput.val()).trigger("update")},backgroundChanged:function(){var a=this.imageBackground.val();WP_DEBUG&&console.log("backgroundChanged");if(""!=
a&&null!=a&&"undefined"!=a){this.loadingImage=!0;this.$loadingBackground.stop().show().fadeTo(200,1);var d=this.currentSlide;""==this.slideThumbnail.val()&&this.slideThumbnail.val(a).trigger("update");jQuery.post(adminAjax,{action:"get-attachment",id:a},b.proxy(function(c){if(!0==c.success&&d==this.currentSlide){this.currentImageWidth=c.data.width;this.currentImageHeight=c.data.height;var e=this.getBackground("image",c.data.url,this.currentImageWidth,this.currentImageHeight,a);this.$background.html(e);
this.kenBurnsInitial.trigger("changeImage",[c.data.url,c.data.width,c.data.height]);this.kenBurnsFinal.trigger("changeImage",[c.data.url,c.data.width,c.data.height]);this.$subButtons.eq(1).removeClass("inactive");this.$subButtons.eq(2).removeClass("inactive");void 0!=c.data.sizes.thumbnail?this.$slidesList.trigger("changeImage",[this.currentSlide,c.data.sizes.thumbnail.url]):this.$slidesList.trigger("changeImage",[this.currentSlide,c.data.sizes.full.url])}d==this.currentSlide&&(this.loadingImage=
!1,this.$loadingBackground.stop().fadeTo(200,0,function(){b(this).hide()}))},this))}else this.$slidesList.trigger("changeImage",[this.currentSlide,builderPathGlobal+"/images/slider_builder/no_slide.png"]),this.$background.html("")},getBackground:function(a,d,c,e,f){if(""==d||null==d)return"";if("image"==a){a=this.height;if(900<c){var g=c/900;c/=g;e/=g}e<a&&(g=e/a,c/=g,e/=g);return b('<img src="'+d+'" alt="background image" width="'+c+'" height="'+e+'" rel="'+f+'" />')}c="";"vimeo"==a?c=b('<iframe src="http://player.vimeo.com/video/'+
d+'" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):"youtube"==a?c=b('<iframe src="http://www.youtube.com/embed/'+d+'?rel=0&autohide=1&showinfo=0&wmode=opaque" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):"dailymotion"==a&&(c=b('<iframe src="http://www.dailymotion.com/embed/video/'+d+'" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'));
return c},slidesOrderChanged:function(a,b,c){this.currentSlide==b?this.currentSlide=c:this.currentSlide==c&&(this.currentSlide=b);a=[];for(var e=0;e<this.slides.length;e++)e==b?a.push(this.slides[c]):e==c?a.push(this.slides[b]):a.push(this.slides[e]),this.$slidesList.trigger("changeTitle",[e,"Slide "+(e+1)+(this.currentSlide==e?" (selected)":"")]);this.slides=a;this.updateMenu()},slideListRemoved:function(a,b){this.slides=removePositionInArray(this.slides,b);0==this.slides.length&&this.slides.push(new h);
this.updateSlide();return!1},reTitleSlides:function(){for(var a=0;a<this.slides.length;a++)this.$slidesList.trigger("changeTitle",[a,"Slide "+(a+1)+(this.currentSlide==a?" (selected)":"")])},updateMenu:function(){this.$currentSlideInfo.text(this.currentSlide+1+"/"+this.slides.length);this.$durationInput.val(this.slides[this.currentSlide].parameters.slideDuration.toString());0==this.currentSlide?this.$previousSlide.removeClass("active"):this.$previousSlide.addClass("active");this.currentSlide>=this.slides.length-
1?this.$nextSlide.removeClass("active"):this.$nextSlide.addClass("active")},updateSlide:function(){WP_DEBUG&&console.log("UpdateSlide");0>this.currentSlide?this.currentSlide=0:this.currentSlide>=this.slides.length&&(this.currentSlide=this.slides.length-1);this.elementIsSelected&&this.selectedElement.unselectElem();var a=this.slides[this.currentSlide].getBackground();this.$background.html("");"image"==a.type?(void 0!=a.id&&this.imageBackground.val(a.id).trigger("update"),this.backgroundType.val("image").trigger("update")):
"color"==a.type?(this.backgroundSlideColor.val(a.id),this.backgroundSlideColor.trigger("update"),this.backgroundType.val(a.type).trigger("update")):(this.videoIdInput.val(a.id),this.videoBackgroundType.val(a.type),this.videoBackgroundType.trigger("update"),this.videoThumbInput.val(a.thumb),this.videoThumbInput.trigger("update"),this.backgroundType.val("video").trigger("update"),this.videoAutoplayInput.val(a.videoAutoplay).trigger("update"));this.slideThumbnail.val(a.thumbnail);this.slideThumbnail.trigger("update");
this.backgroundTypeChanged();var d=this.slides[this.currentSlide].getKenBurns();this.kenBurnsInitial.hasClass("ready")?this.kenBurnsInitial.val(d.startTop+"/"+d.startLeft+"/"+d.startSize).trigger("update"):this.kenBurnsInitial.bind("bindsReady",b.proxy(function(){this.kenBurnsInitial.val(d.startTop+"/"+d.startLeft+"/"+d.startSize).trigger("update")},this));this.kenBurnsFinal.hasClass("ready")?this.kenBurnsFinal.val(d.endTop+"/"+d.endLeft+"/"+d.endSize).trigger("update"):this.kenBurnsFinal.bind("bindsReady",
b.proxy(function(){this.kenBurnsFinal.val(d.endTop+"/"+d.endLeft+"/"+d.endSize).trigger("update")},this));this.useKenBurns.val(d.use).trigger("update");this.kenBurnsDuration.val(d.duration);this.background_vertical_snapping.val(this.slides[this.currentSlide].parameters.vertical_snapping).trigger("update");this.background_horizontal_snapping.val(this.slides[this.currentSlide].parameters.horizontal_snapping).trigger("update");this.slides[this.currentSlide].appendElements();for(var a=this.slides[this.currentSlide],
c=a.elements.length-1;0<=c;c--){for(var e,f=0;f<a.elements.length;f++)if(a.elements[f].depth==c){e=a.elements[f];break}this.addElementToList(e)}this.$durationInput.val(this.slides[this.currentSlide].parameters.slideDuration);this.updateShowingTabs();this.updateMenu();this.reTitleSlides()},saveSlide:function(){this.slides[this.currentSlide].parameters.slideDuration=this.$durationInput.val();var a=this.backgroundType.val(),b=this.videoBackgroundType.val();this.slides[this.currentSlide].setBackground({type:"video"==
a?b:a,id:"video"==a?this.videoIdInput.val():"image"==a?this.imageBackground.val():this.backgroundSlideColor.val(),thumb:"video"==a?this.videoThumbInput.val():"",thumbnail:this.slideThumbnail.val(),videoAutoplay:this.videoAutoplayInput.val()});var a=this.kenBurnsInitial.val().split("/"),b=this.kenBurnsFinal.val().split("/"),c=this.useKenBurns.val(),e=this.kenBurnsDuration.val();this.slides[this.currentSlide].setKenBurns({use:c,delay:0,duration:e,startTop:a[0],startLeft:a[1],startSize:a[2],endTop:b[0],
endLeft:b[1],endSize:b[2]});this.slides[this.currentSlide].parameters.vertical_snapping=this.background_vertical_snapping.val();this.slides[this.currentSlide].parameters.horizontal_snapping=this.background_horizontal_snapping.val();this.elementUnselected();this.$elementsList.trigger("reset");this.slides[this.currentSlide].removeElements()},goToSlideProperties:function(a,b){b!=this.currentSlide&&(this.saveSlide(),this.currentSlide=b,this.updateSlide());this.changeTab(0)},addSlideToList:function(){var a=
b('<span class="image" style="background-size:36px 24px; width: 36px; background-image: url('+builderPathGlobal+'/images/slider_builder/no_slide.png);"></span><p class="title">Slide '+this.slides.length+'</p><a href="#" data-event="properties" onclick="return false;">Edit properties</a>');this.$slidesList.hasClass("ready")?this.$slidesList.trigger("addItem",[a]):this.$slidesList.bind("bindsReady",b.proxy(function(){this.$slidesList.trigger("addItem",[a])},this))},newSlide:function(){this.saveSlide();
this.slides.push(new h);this.currentSlide=this.slides.length-1;this.addSlideToList();this.updateSlide();this.currentTab=0;this.updateTab();return!1},removeSlide:function(){this.slides=removePositionInArray(this.slides,this.currentSlide);this.$slidesList.trigger("removeItem",[this.currentSlide]);0==this.slides.length&&this.slides.push(new h);this.updateSlide();return!1},nextSlide:function(){this.currentSlide<this.slides.length-1&&(this.saveSlide(),this.currentSlide++,this.updateSlide());return!1},
previousSlide:function(){0<this.currentSlide&&(this.saveSlide(),this.currentSlide--,this.updateSlide());return!1},changeSlideDuration:function(){var a=parseFloat(this.$durationInput.val(),10);this.slides[this.currentSlide].slideDuration=a},info:function(){return this.slides.length},makeHtml:function(){this.saveSlide();b("#content").val(this.val())},val:function(){var a="",a=a+("<div id='slider_"+this.id+"' class='slider' rel='");b.each(this.mainOptionsIds,function(c,d){var f=b("#"+d).val();a+=d+":"+
f+"; "});for(var a=a+"'><div class='slides'>",d=0;d<this.slides.length;d++)a+=this.slides[d].val();return a+="</div></div>"},initialValues:function(){if(void 0!=this.iniValue&&""!=this.iniValue){var a=b(this.iniValue),d=stringToObject(a.attr("rel"));b.each(this.mainOptionsIds,function(a,e){var f=b("#"+e);f.val(d[e]);f.trigger("update").trigger("change")});a=b(".slide",a);0<a.length?(this.slides=removePositionInArray(this.slides,0),a.each(b.proxy(function(a,d){var f=b(d),g=new h;g.setVal(f);this.slides.push(g);
this.addSlideToList();var l=g.getBackground();"image"==l.type?void 0!=l.id&&""!=l.id&&jQuery.post(adminAjax,{action:"get-attachment",id:l.id},b.proxy(function(b){void 0!=b.data.sizes.thumbnail?this.$slidesList.trigger("changeImage",[a,b.data.sizes.thumbnail.url]):this.$slidesList.trigger("changeImage",[a,b.data.sizes.full.url])},this)):this.$slidesList.trigger("changeImage",[a,builderPathGlobal+"/images/slider_builder/video_slide.png"]);f.find(".slide_elements >*").each(b.proxy(function(d,e){var f=
b(e),h=f.find(">*"),f=jQuery.parseJSON(f.attr("rel"));e="image"==f.type?new k.ImageElement(g.elements.length,this.$elements,h.clone(),f.iniWidth,f.iniHeight,0===a,f):"button"==f.type?new k.ButtonElement(g.elements.length,this.$elements,h.clone(),0===a,f):new k.TextElement(g.elements.length,this.$elements,h.clone(),0===a,f);g.addElement(e)},this))},this)),this.updateSlide()):this.updateMenu()}else this.updateMenu()}};return m});
