define(["jquery"],function(){var c=function(a,d,b){this.active=d;this.options=b;/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.active)||(this.active="#000000");this.opened=!1;this.$holder=$("#"+a+"_palette_combobox");this.$input=$("#"+a);this.$color=this.$holder.find(".color");this.$toogle_btn=this.$holder.find(">a");this.build();this.update();this.$toogle_btn.click($.proxy(this.toogle_dropdown,this));this.$input.on("input",$.proxy(this.on_input,this))};c.prototype={on_input:function(){var a=this.$input.val();
/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)&&(this.active=a,this.update())},build:function(){this.$options_holder=$('<div class="palette_combobox_options"></div>');$.each(this.options,$.proxy(function(a,b){var c=$('<a class="option" href="#" onclick="return false;" data-color="'+b.color+'"><div class="color" style="background-color:'+b.color+';"></div><p>'+b.title+"</p></a>");c.click($.proxy(this.option_clicked,this));this.$options_holder.append(c)},this));this.$options=this.$options_holder.find(".option");
$("body").append(this.$options_holder);var a=this.$options_holder.width();this.options_holder_height=this.$options_holder.height();150<a&&this.$holder.css("width",a+"px");this.$options_holder.hide()},update:function(){this.$color.css("background-color",this.active);$.each(this.$options,$.proxy(function(a,c){var b=$(c);b.data("color")===this.active?b.addClass("active"):b.removeClass("active")},this));this.$input.val(this.active)},option_clicked:function(a){a=$(a.target);a.hasClass("option")||(a=a.parent());
this.active=a.data("color");this.update()},toogle_dropdown:function(){if(this.opened)this.close_dropdown();else{this.$options_holder.show();var a=this.$holder.offset();this.$options_holder.css({top:a.top-this.options_holder_height+"px",left:a.left+"px"});this.$holder.addClass("opened");this.$holder.hover($.proxy(this.stop_close_timer,this),$.proxy(this.start_close_timer,this));this.$options_holder.hover($.proxy(this.stop_close_timer,this),$.proxy(this.start_close_timer,this));this.$toogle_btn.find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down");
this.opened=!0}},close_dropdown:function(){this.opened&&(this.$options_holder.hide(),this.$holder.removeClass("opened"),this.$holder.unbind("hover"),this.$options_holder.unbind("hover"),this.$toogle_btn.find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),this.opened=!1)},start_close_timer:function(){this.closeInterval=setTimeout($.proxy(this.close_dropdown,this),200)},stop_close_timer:function(){clearTimeout(this.closeInterval)}};return c});
