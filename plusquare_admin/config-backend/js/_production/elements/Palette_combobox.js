define(["jquery"],function(a){var d=function(b,e,c){this.active=e;this.options=c;/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.active)||(this.active="#000000");this.opened=!1;this.$holder=a("#"+b+"_palette_combobox");this.$input=a("#"+b);this.$color=this.$holder.find(".color");this.$toogle_btn=this.$holder.find(">a");this.build();this.update();this.$toogle_btn.click(a.proxy(this.toogle_dropdown,this));this.$input.on("input",a.proxy(this.on_input,this))};d.prototype={on_input:function(){var a=this.$input.val();
/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)&&(this.active=a,this.update())},build:function(){this.$options_holder=a('<div class="palette_combobox_options"></div>');a.each(this.options,a.proxy(function(b,c){var d=a('<a class="option" href="#" onclick="return false;" data-color="'+c.color+'"><div class="color" style="background-color:'+c.color+';"></div><p>'+c.title+"</p></a>");d.click(a.proxy(this.option_clicked,this));this.$options_holder.append(d)},this));this.$options=this.$options_holder.find(".option");
a("body").append(this.$options_holder);var b=this.$options_holder.width();this.options_holder_height=this.$options_holder.height();150<b&&this.$holder.css("width",b+"px");this.$options_holder.hide()},update:function(){this.$color.css("background-color",this.active);a.each(this.$options,a.proxy(function(b,d){var c=a(d);c.data("color")===this.active?c.addClass("active"):c.removeClass("active")},this));this.$input.val(this.active)},option_clicked:function(b){b=a(b.target);b.hasClass("option")||(b=b.parent());
this.active=b.data("color");this.update()},toogle_dropdown:function(){if(this.opened)this.close_dropdown();else{this.$options_holder.show();var b=this.$holder.offset();this.$options_holder.css({top:b.top-this.options_holder_height+"px",left:b.left+"px"});this.$holder.addClass("opened");this.$holder.hover(a.proxy(this.stop_close_timer,this),a.proxy(this.start_close_timer,this));this.$options_holder.hover(a.proxy(this.stop_close_timer,this),a.proxy(this.start_close_timer,this));this.$toogle_btn.find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down");
this.opened=!0}},close_dropdown:function(){this.opened&&(this.$options_holder.hide(),this.$holder.removeClass("opened"),this.$holder.unbind("hover"),this.$options_holder.unbind("hover"),this.$toogle_btn.find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),this.opened=!1)},start_close_timer:function(){this.closeInterval=setTimeout(a.proxy(this.close_dropdown,this),200)},stop_close_timer:function(){clearTimeout(this.closeInterval)}};return d});
