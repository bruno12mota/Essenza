define(["jquery"],function(c){var f=function(a){this.$orderable_list=c("#"+a);this.itemId=-1;this.reset();this.$orderable_list.bind("addItem",c.proxy(this.addItem,this));this.$orderable_list.bind("removeItem",c.proxy(this.removeItem,this));this.$orderable_list.bind("changeImage",c.proxy(this.changeImage,this));this.$orderable_list.bind("changeTitle",c.proxy(this.changeTitle,this));this.$orderable_list.bind("reset",c.proxy(this.reset,this))};f.prototype={changeImage:function(a,b,c){this.items.length>
b&&this.items[b].find(".image").css("background-image","url("+c+")")},changeTitle:function(a,b,c){this.items.length>b&&this.items[b].find(".title").text(c)},eventButtonClick:function(a){var b=c(a.target);this.getItem(b);a=parseInt(this.$item.attr("rel"),10);b=b.data("event");this.$orderable_list.triggerHandler(b,[a])},addItem:function(a,b,e){a=this.numItems;b=c('<div class="item"></div>').append(c('<div class="dynamic_part"></div>').append(b)).append(c('<div class="fix_part"><a class="depth_up" href="#" onclick="return false;"></a><a class="remove_element" href="#" onclick="return false;"></a><a class="depth_down" href="#" onclick="return false;"></a></div>')).attr("rel",
a).css("top",51*a+"px");this.$orderable_list.append(b);b.find(".dynamic_part a").each(c.proxy(function(a,b){var e=c(b);void 0!=e.data("event")&&e.click(c.proxy(this.eventButtonClick,this))},this));b.bind(mouseDownBind,c.proxy(this.dragDown,this)).addClass("grabhand");b.find(".depth_up").click(c.proxy(this.depthUpClick,this));b.find(".depth_down").click(c.proxy(this.depthDownClick,this));b.find(".remove_element").click(c.proxy(this.removeClick,this));void 0!=e?this.items.splice(e,0,b):this.items.push(b);
this.numItems=this.items.length;this.$orderable_list.css("height",51*this.numItems+"px");this.organize()},removeItem:function(a,b){for(var c=[],d=0;d<this.numItems;d++)d==b?this.items[d].remove():c.push(this.items[d]);this.items=c;this.numItems=this.items.length;this.organize()},removeClick:function(a){a=c(a.target);this.getItem(a);a=parseInt(this.$item.attr("rel"),10);this.removeItem(null,a);this.$orderable_list.trigger("itemRemoved",[a])},reset:function(){this.items=[];this.numItems=0;this.$orderable_list.find(".item").remove()},
dragDown:function(a){var b=c(a.target);this.$item=this.getItem(b);this.position=this.itemId=parseInt(this.$item.attr("rel"),10);this.mouseY=a.pageY;this.currentY=51*this.position;this.$item.addClass("down");c(document).bind(mouseMoveBind,c.proxy(this.dragMove,this));c(document).bind(mouseUpBind,c.proxy(this.dragUp,this));return!1},organize:function(){for(var a=0;a<this.numItems;a++){var b=this.items[a];b.attr("rel",a);0==a%2?b.removeClass("pair"):b.addClass("pair");if(a!=this.itemId){var c=51*a,d=
parseInt(b.css("top"),10);c!=d&&b.stop().animate({top:c+"px"},300)}0==a?b.find(".depth_up").addClass("disabled"):b.find(".depth_up").removeClass("disabled");a==this.numItems-1?b.find(".depth_down").addClass("disabled"):b.find(".depth_down").removeClass("disabled")}},dragMove:function(a){var b=a.pageY-this.mouseY;this.mouseY=a.pageY;a=this.currentY+=b;0>a&&(a=0);a>51*(this.numItems-1)&&(a=51*(this.numItems-1));this.$item.css("top",a+"px");for(var c=b=0;c<this.numItems;c++)a>25+50*c&&(b=c+1);this.changeItemPosition(this.itemId,
b);return!1},dragUp:function(a){unbindMoveAndUp();this.$item.removeClass("down");this.itemId=-1;this.organize();return!1},changeItemPosition:function(a,b){if(a!=b&&0<=b&&b<this.numItems){for(var c=[],d=0;d<this.numItems;d++)d==a?c.push(this.items[b]):d==b?c.push(this.items[a]):c.push(this.items[d]);-1!=this.itemId&&(this.itemId=this.position=b);this.items=c;this.organize();this.$orderable_list.trigger("itemChanged",[a,b])}},getItem:function(a){return a.hasClass("item")?a:a.closest(".item")},depthUpClick:function(a){a=
this.getItem(c(a.target));a=parseInt(a.attr("rel"),10);this.changeItemPosition(a,a-1)},depthDownClick:function(a){a=this.getItem(c(a.target));a=parseInt(a.attr("rel"),10);this.changeItemPosition(a,a+1)}};return f});
