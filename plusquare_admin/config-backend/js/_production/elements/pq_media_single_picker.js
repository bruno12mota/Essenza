define(["jquery"],function(c){var d=function(b,a,e){this.width=a;this.height=e;void 0==this.width&&(this.width=400);void 0==this.height&&(this.height=250);jQuery(document).ready(c.proxy(function(a){this.id=b;this.$input=a("#"+this.id).bind("update",a.proxy(this.updateImage,this));this.$button=a("#"+this.id+"_button");this.$grid=a("#"+this.id+"_grid");this.img=a("img",this.$grid);this.frame=wp.media({title:"Pick an image",multiple:!1,library:{type:"image"},button:{text:"Choose"}});this.$button.click(a.proxy(this.buttonClick,
this));this.updateImage()},this))};d.prototype={buttonClick:function(b){this.frame.on("close",c.proxy(this.frameClose,this));this.frame.on("open",c.proxy(this.frameOpen,this));this.frame.open();return!1},frameOpen:function(){var b=this.frame.state().get("selection"),a=this.$input.val(),a=wp.media.attachment(a);a.fetch();b.add(a?[a]:[])},frameClose:function(){var b=null;this.frame.state().get("selection").forEach(c.proxy(function(a){b=a.id;this.$input.val(b)},this));this.updateImage()},updateImage:function(b){var a=
this.$input.val();""!=a&&null!=a?jQuery.post(adminAjax,{action:"pq_get_attachment",attachmentID:a,width:this.width,height:this.height,crop:"true"},c.proxy(function(a){WP_DEBUG&&console.log(a);!0==a.success&&(this.img.remove(),this.img=c("<img />").appendTo(this.$grid.find(".item-inner .img")),this.img.attr("src",a.data.url),this.$grid.find(".item-inner .img").data("src",a.data.url).data("width",a.data.width).data("height",a.data.height),void 0==b&&this.$input.trigger("change"))},this)):this.img.remove()}};
return d});
