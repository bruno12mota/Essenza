define(["jquery","utils/utils"],function(b){var c=function(a,d,f,e,c,g){this.$target=a;this.enabled=!1;this.limited=f;this.width=e;this.height=c;this.widthRatio=g;void 0!=d&&(this.enabled=d);a={position:"absolute","margin-left":"-4px","margin-top":"-4px",cursor:"pointer"};this.$dragArea=b("<div></div>").css({width:"100%",height:"100%",position:"absolute",top:"0",left:"0"});this.$holder=b("<div></div>").css({width:"100%",height:"100%",position:"absolute",top:"0",left:"0"}).appendTo(this.$target).append(this.$dragArea).append(b('<div class="scale_button"></div>').css(a).css({left:"0",
top:"0"}).attr("rel","lt").bind(mouseDownBind,b.proxy(this.scaleDown,this))).append(b('<div class="scale_button"></div>').css(a).css({left:"100%",top:"0"}).attr("rel","rt").bind(mouseDownBind,b.proxy(this.scaleDown,this))).append(b('<div class="scale_button"></div>').css(a).css({left:"0%",top:"100%"}).attr("rel","lb").bind(mouseDownBind,b.proxy(this.scaleDown,this))).append(b('<div class="scale_button"></div>').css(a).css({left:"100%",top:"100%"}).attr("rel","rb").bind(mouseDownBind,b.proxy(this.scaleDown,
this)));this.bottom=this.right=this.left=this.top=0;this.enabled||this.$holder.css("display","none")};c.prototype={enable:function(){this.$holder.css("display","block");this.enabled=!0},disable:function(){this.$holder.css("display","none");this.enabled=!1},update:function(){this.top=parseInt(this.$target.css("top"),10);this.left=parseInt(this.$target.css("left"),10);this.bottom=parseInt(this.$target.css("bottom"),10);this.right=parseInt(this.$target.css("right"),10);void 0!=this.widthRatio&&this.ratioWidth();
this.$target.css({top:this.top+"px",left:this.left+"px",bottom:this.bottom+"px",right:this.right+"px"})},changeRatio:function(a){this.widthRatio=a;this.update()},changeSize:function(a,b){this.width=a;this.height=b},scaleDown:function(a){if(this.enabled){var d=b(a.target).attr("rel");this.iniX=a.pageX;this.iniY=a.pageY;this.fromLeft=!1;"l"==d.charAt(0)&&(this.fromLeft=!0);this.fromTop=!1;"t"==d.charAt(1)&&(this.fromTop=!0);this.initop=parseInt(this.$target.css("top"),10);this.inileft=parseInt(this.$target.css("left"),
10);this.inibottom=parseInt(this.$target.css("bottom"),10);this.iniright=parseInt(this.$target.css("right"),10);this.top=this.initop;this.left=this.inileft;this.bottom=this.inibottom;this.right=this.iniright;b(document).bind(mouseMoveBind,b.proxy(this.scaleMove,this));b(document).bind(mouseUpBind,b.proxy(this.scaleUp,this))}return!1},scaleMove:function(a){var b=a.pageX-this.iniX;a=a.pageY-this.iniY;this.fromTop?this.top=this.initop+a:this.bottom=this.inibottom-a;this.fromLeft?this.left=this.inileft+
b:this.right=this.iniright-b;this.limited&&(0>this.left&&(this.left=0),0>this.right&&(this.right=0),0>this.top&&(this.top=0),0>this.bottom&&(this.bottom=0));void 0!=this.widthRatio&&(b>a?this.ratioWidth():this.ratioHeight());this.$target.css({top:this.top+"px",left:this.left+"px",bottom:this.bottom+"px",right:this.right+"px"});this.$target.trigger("scale",{top:this.top,left:this.left,bottom:this.bottom,right:this.right});return!1},ratioWidth:function(){var a=(this.width-this.left-this.right)/this.widthRatio-
(this.height-this.top-this.bottom);this.fromTop?(this.top-=a,this.limited&&0>this.top&&(a=0-this.top,this.top=0,this.bottom-=a,0>this.bottom&&(this.bottom=0,this.ratioHeight()))):(this.bottom-=a,this.limited&&0>this.bottom&&(a=0-this.bottom,this.bottom=0,this.top-=a,0>this.top&&(this.top=0,this.ratioHeight())))},ratioHeight:function(){var a=(this.height-this.top-this.bottom)*this.widthRatio-(this.width-this.left-this.right);this.fromLeft?(this.left-=a,this.limited&&0>this.left&&(a=0-this.left,this.left=
0,this.right-=a,0>this.right&&(this.right=0,this.ratioWidth()))):(this.right-=a,this.limited&&0>this.right&&(a=0-this.right,this.right=0,this.left-=a,0>this.left&&(this.left=0,this.ratioWidth())))},scaleUp:function(){unbindMoveAndUp();return!1},change:function(a,b,c,e){this.$target.css({top:a+"px",left:b+"px",bottom:c+"px",right:e+"px"})}};return c});
