define(["jquery","elements/Scalable","elements/Dragable"],function(h,l,m){var k=function(c,a,e,b){this.values={top:0,left:0,bottom:0,right:0,topRel:0,leftRel:0,size:1};c.css({width:e,height:b});this.widthRatio=2;this.width=e;this.height=b;this.$scaler=c.find(".scaler");this.scalable=new l(c.find(".scaler"),!0,!0,e,b,this.widthRatio);this.dragable=new m(c.find(".scaler"),this.scalable.$dragArea,!0);this.$scaler.bind("scale",h.proxy(this.changed,this));this.$scaler.bind("drag",h.proxy(this.changed,
this))};k.prototype={changed:function(c,a){this.values=a;var e=Math.max((this.width-(a.left+a.right))/this.width,(this.height-(a.top+a.bottom))/this.height),b=this.height-a.top-a.bottom,d=this.width-a.left-a.right;this.width/this.height>this.widthRatio?d=b*this.widthRatio:b=d/this.widthRatio;this.values.size=e;this.values.topRel=0!=this.height-b?a.top/(this.height-b):0;this.values.leftRel=0!=this.width-d?a.left/(this.width-d):0;h(this).trigger("change")},changeRatio:function(c){this.widthRatio=c;
this.scalable.changeRatio(c)},changeSize:function(c,a,e){this.width=c;this.height=a;this.scalable.changeSize(c,a);this.val(e)},val:function(c){if(void 0==c)return this.values;var a=c.split("/");if(void 0!=this.widthRatio){c=parseFloat(a[0],10);var e=parseFloat(a[1],10),a=parseFloat(a[2],10),b,d;this.width/this.height>this.widthRatio?(d=a*this.height,b=d*this.widthRatio):(b=a*this.width,d=b/this.widthRatio);var f=c*(this.height-d),g=e*(this.width-b);d=this.height-f-d;b=this.width-g-b;this.values.top=
f;this.values.left=g;this.values.bottom=d;this.values.right=b;this.values.size=a;this.values.topRel=c;this.values.leftRel=e}else f=parseFloat(a[0],10),b=parseFloat(a[1],10),d=parseFloat(a[2],10),g=parseFloat(a[3],10),this.values.top=f,this.values.left=g,this.values.bottom=d,this.values.right=b;this.scalable.change(f,g,d,b)}};return k});
