define("jquery libraries/jquery.mobile.vmouse Lightbox/Lightbox ./PageBuilder/ModuleButton ./PageBuilder/Module ./PageBuilder/Line ./PageBuilder/Tooltip utils/utils ui-elements".split(" "),function(a,z,w,D,s,E){var x;z=function(b,c,e,f){x=e;this.saved_pages=f;builderPath=c;$body=a("body");this.modules=[];this.lineNum=0;this.lines=[];this.linesSnaps=[];this.bottomSnaps=[];this.lineOver=0;this.$pageBuilderTab=b;this.build();this.moduleDragging=-1;a(window).resize(a.proxy(this.onResize,this));a("#post").submit(a.proxy(this.makeHtml,
this));this.fromHtml();this.menuFromTop=this.$pageBuilderMenu.offset().top;this.menuOffTop=a("#wpbody").offset().top;a(window).scroll(a.proxy(this.onScroll,this))};z.prototype={build:function(){this.$pageBuilderMenu=a("<div class='menu'></div>").appendTo(this.$pageBuilderTab);this.$pageBuilderTab.bind("save",a.proxy(this.makeHtml,this));var b=a("<div class='menu-button'></div>").appendTo(this.$pageBuilderMenu),c=a("<a href='#'>Add new placeholder</a>").appendTo(b);processIcon(c,builderPath+"images/MainMenu/placeholder_icon.png");
var c=a("<div class='menu-button'></div>").appendTo(this.$pageBuilderMenu),e=a("<a href='#'>Add new module</a>").appendTo(c);processIcon(e,builderPath+"images/MainMenu/add_icon.png");e=a("<div class='menu-button'></div>").appendTo(this.$pageBuilderMenu);e=a("<a href='#'>Add Pagebreak</a>").appendTo(e);processIcon(e,builderPath+"images/MainMenu/add_icon.png");var f=a("<div class='menu-button right'></div>").appendTo(this.$pageBuilderMenu),d=a("<a href='#'>Load page</a>").appendTo(f);processIcon(d,
builderPath+"images/MainMenu/load_icon.png");var d=a("<div class='menu-button right' style='position:relative;'></div>").appendTo(this.$pageBuilderMenu),g=a("<a href='#'>Save page</a>").appendTo(d);processIcon(g,builderPath+"images/MainMenu/save_icon.png");g=a("<div class='menu-button right'></div>").appendTo(this.$pageBuilderMenu);g=a("<a href='#'>Clear page</a>").appendTo(g).click(a.proxy(this.clearAllClick,this));processIcon(g,builderPath+"images/MainMenu/delete_icon.png");var l=this.$loadModuleMenu=
a("<div class='menu-dropdown' id='loadDrop'></div>").appendTo(f);f.hover(function(){l.stop().css("display","block").fadeTo(150,1)},function(){l.stop().fadeTo(150,0,function(){a(this).css("display","none")})});this.number_saved_pages=0;a.each(this.saved_pages,a.proxy(function(b,c){this.add_new_page_template_button(b)},this));0==this.number_saved_pages&&this.$loadModuleMenu.html("<p>No saved pages to load!</p>");var h=a("<div class='menu-dropdown' id='saveDrop'></div>").appendTo(d);this.save_input=
a("<input type='text'/>").appendTo(h);a('<a href="#" onclick="return false;">Save</a>').appendTo(h).click(a.proxy(this.save_page,this));var p=this.save_input;d.hover(function(){p.unbind("blur");h.stop().css("display","block").fadeTo(150,1)},function(){p.is(":focus")?p.bind("blur",function(){h.stop().fadeTo(150,0,function(){a(this).css("display","none")})}):h.stop().fadeTo(150,0,function(){a(this).css("display","none")})});var r=a("<div class='menu-dropdown' id='placeholderDrop' style='left: -1px;'></div>").appendTo(b);
b.hover(function(){r.stop().css("display","block").fadeTo(150,1)},function(){r.stop().fadeTo(150,0,function(){a(this).css("display","none")})});var b=a("<div class='wraper'></div>").appendTo(r).append(a("<div class='info-small-pb'>Info</div>")).append(a("<div class='info-pb'>Drag and drop these placeholders on the canvas to create spaces in which you can later drag and drop modules.</div>")),d=a("<div class='row-fluid columns-wraper'></div>").appendTo(r),f=a("<div class='span6'></div>").appendTo(d),
d=a("<div class='span6'></div>").appendTo(d),m=[f,d];a.each([{image:"images/Placeholder/1-1.png",column:0,label:"1",sizes:[12]},{image:"images/Placeholder/1-2.png",column:0,label:"1/2",sizes:[6]},{image:"images/Placeholder/1-2_1-2.png",column:0,label:"1/2 + 1/2",sizes:[6,6]},{image:"images/Placeholder/1-3.png",column:0,label:"1-3",sizes:[4]},{image:"images/Placeholder/1-3_1-3_1-3.png",column:0,label:"1-3 + 1-3 + 1-3",sizes:[4,4,4]},{image:"images/Placeholder/1-3_2-3.png",column:1,label:"1/3 + 2/3",
sizes:[4,8]},{image:"images/Placeholder/2-3_1-3.png",column:1,label:"2/3 + 1/3",sizes:[8,4]},{image:"images/Placeholder/1-6.png",column:1,label:"1/6",sizes:[2]},{image:"images/Placeholder/1-6_1-6_1-6_1-6_1-6_1-6.png",column:1,label:"1/6 + 1/6 + 1/6 + 1/6 + 1/6 + 1/6",sizes:[2,2,2,2,2,2]}],a.proxy(function(b,c){var e=new D.PlaceholderButton(builderPath+c.image,c.label,c.sizes);m[c.column].append(e.$obj);a(e).bind("moduleButtonDown",a.proxy(this.createPlaceholder,this))},this));e.click(a.proxy(this.createPageBreak,
this));var n=a("<div class='menu-dropdown' id='modulesDrop'></div>").appendTo(c);c.hover(function(){n.stop().css("display","block").fadeTo(150,1)},function(){n.stop().fadeTo(150,0,function(){a(this).css("display","none")})});c=b.clone().appendTo(n);a("div.info-pb",c).text("Drag and drop these modules within placeholders. Once placed, you can edit the modules by pressing the edit icon and drag an drop them to different locations.");a("<p class='title_menu'>Shortcodes</p>").appendTo(n);var f=a("<div class='row-fluid columns-wraper'></div>").appendTo(n),
c=a("<div class='span3 column'></div>").appendTo(f),e=a("<div class='span3 column'></div>").appendTo(f),b=a("<div class='span3 column'></div>").appendTo(f),f=a("<div class='span3 column'></div>").appendTo(f),k=[c,e,b,f],c=0,y;for(y in x)x.hasOwnProperty(y)&&c++;var q=Math.ceil(c/4),s=0,t=0;a.each(x,a.proxy(function(b,c){var e=new D.ComponentButton(c);k[t].append(e.$obj);s++;s==q&&(s=0,t++);a(e).bind("moduleButtonDown",a.proxy(this.createComponent,this))},this));this.$view=a("<div class='view'></div>").appendTo(this.$pageBuilderTab);
this.$viewHolder=a("<div class='viewHolder'></div>").appendTo(this.$view);this.$linesHolderOuter=a("<div class='linesHolder'></div>").appendTo(this.$viewHolder);this.$linesHolder=a("<div class='linesHolderInner'></div>").appendTo(this.$linesHolderOuter);this.$baseLine=a("<div class='lineBase'></div>").appendTo(this.$linesHolder);y=100*(1/6);for(c=0;7>c;c++)a("<div></div>").css({position:"absolute",width:"9px",height:"9px",left:-4-0.2*c+"px","margin-left":y*c+"%","background-image":"url("+builderPath+
"images/General/grid_plus.png)","background-repeat":"no-repeat"}).appendTo(this.$baseLine);this.addLine();this.addLine();this.addLine();this.$top_snap=a("<a href='#' class='snap_button to_top' data-snap='top'></a>").appendTo(this.$view).click(this.snap_click);this.$bottom_snap=a("<a href='#' class='snap_button to_bottom' data-snap='bottom'></a>").appendTo(this.$view).click(this.snap_click);new Tooltip(this.$top_snap,"Snap first row to the top",builderPath);new Tooltip(this.$bottom_snap,"Snap last row with content to the bottom",
builderPath)},fromHtml:function(){var b=a("#content").val().toString();console.log("CONTENT:"+b+"\n\n");var c="(";a.each("raw text text_box text_header quote message_box accordion tabs image blog_gallery slider socialVideo music_player divider text_divider vertical_space contact_form button image_button actionbox display-posts google_maps flickr behance pinterest dribbble instagram facebook_like google_plus twitter_button tweet_feed tweet".split(" "),function(b,a){0!=b&&(c+="|");c+=a});c+=")";if(null!=
b&&void 0!=b){b=b.match(RegExp("(\\[row.*?\\][\\s\\S]*?\\[\\/row\\]|\\<\\!\\-\\-nextpage\\-\\-\\>)","gi"));if(null!=b)for(var e=0;e<b.length;e++)if(console.log("ROW: "+b[e]+"\n\n"),"\x3c!--nextpage--\x3e"==b[e])console.log("Found line break!\n\n"),this.createPageBreak();else{var f=b[e].match(/snaps=".*?"/i);if(null!=f)var f=f[0],d=7,g=f.length-1,l=f.substring(d,g);var h=b[e].match(RegExp("\\[column.*?\\][\\s\\S]*?\\[\\/column\\]","gi"));if(null!=h)for(var p=0,r=0;r<h.length;r++){console.log("COLUMN: "+
h[r]+"\n");var m=h[r].match(RegExp("\\[column.*?\\]","gi"));if(null==m){console.log("Page Builder error");return}var d='size=".*?"',d=RegExp(d,"i"),n=m[0].match(d),n=n[0],d=6,g=n.length-1,n=parseInt(n.substring(d,g),10),d='offset=".*?"',d=RegExp(d,"i"),k=m[0].match(d),k=k[0],d=8,g=k.length-1,d=parseInt(k.substring(d,g),10),p=p+d;console.log("----------------size: "+n);console.log("----------------offset: "+d);console.log("----------------column: "+p);d=/content_align=".*?"/i;k=m[0].match(d);if(null!=
k)var k=k[0],d=15,g=k.length-1,y=k.substring(d,g);var d=/use_paddings=".*?"/i,q=m[0].match(d);if(null!=q)var q=q[0],d=14,g=q.length-1,w=q.substring(d,g);var d=/padding=".*?"/i,t=m[0].match(d);if(null!=t)var t=t[0],d=9,g=t.length-1,z=t.substring(d,g);d=new s.Placeholder(n,p,this.modules.length);this.lines[e].addModule(d);d.show();d.priority=0;this.modules.push(d);a(d).bind("moduleDown",a.proxy(this.placeholderDown,this));a(d).bind("moduleDelete",a.proxy(this.placeholderDelete,this));a(d).bind("moduleResize",
a.proxy(this.correctGrid,this));a(d).bind("moduleDuplicateInsert",a.proxy(this.duplicateInsertGrid,this));null!=q&&(d.options.use_paddings=w,d.options.padding=z);null!=k&&(d.options.content_align=y);p+=n;m=h[r].substring(m[0].length,h[r].length-9);console.log("----------------content: "+m);n=RegExp("\\["+c+"{1}[\\s\\S]*?\\]","gi");do if(g=m.match(n),null!=g){for(var k=g[0],u="",q=1;" "!=k.charAt(q)&&"]"!=k.charAt(q);)u+=k.charAt(q),q++;console.log("----------------shortcode: "+u);var v=m.match(RegExp("\\["+
u+"[\\s\\S]*?\\][\\s\\S]*?\\[\\/"+u+"\\]","gi"));if(null!=v){v=v[0];console.log("--------------------------------shortcode component: "+v);var m=m.substring(v.length),C=k,k=x[u],A=new s.Component(k),B=function(b){if("content"!=b.associate){console.log(b.associate);var c=RegExp("\\s"+b.associate+'="[\\s\\S]*?"',"i");console.log(C);c=C.match(c);if(null!=c&&(c=c[0],null!=c)){var a=c.substring(b.associate.length+3,c.length-1);console.log(b.associate+": "+a);a=a.toString().replace(/(&quote;)/g,'"');A.parameters[b.id].value=
a}}else a=C.length,c=v.length-(u.length+3),a=c<=a?"":v.substring(a,c),console.log("--------------------------------shortcode content:"+a),A.parameters[b.id].value=a;return a};a.each(k.options,function(b,c){if("tabs"==c.type||"tabs_unbinded"==c.type)if("tabs"==c.type){var e=B(c);a.each(c.tabs[e],function(b,c){B(c)})}else a.each(c.tabs,function(b,c){a.each(c,function(b,c){B(c)})});else B(c)});d.addComponent(A);A.build();a(A).bind("moduleDown",a.proxy(this.componentDown,this))}}while(null!=g&&1<m.length)}this.checkNumLines();
null!=f&&(0==e&&"t"==l.charAt(0)?this.$top_snap.addClass("active"):0==e&&this.$top_snap.removeClass("active"),"l"==l.charAt(1)?this.linesSnaps[e].eq(0).addClass("active"):this.linesSnaps[e].eq(0).removeClass("active"),"r"==l.charAt(2)?this.linesSnaps[e].eq(1).addClass("active"):this.linesSnaps[e].eq(1).removeClass("active"),"b"==l.charAt(3)&&e==b.length-1?this.$bottom_snap.addClass("active"):"b"==l.charAt(3)?this.bottomSnaps[e].addClass("active"):(this.bottomSnaps[e].removeClass("active"),this.$bottom_snap.removeClass("active")))}this.correctGrid()}},
makeHtml:function(){for(var b="",c=0;c<this.lines.length;c++){var e=this.lines[c];if(!e.isEmpty()){(e=1==e.modules.length&&"pagebreak"==e.modules[0].type)||(b+='[row snaps="');var f="",f=0==c&&this.$top_snap.hasClass("active")?f+"t":f+"0",f=this.linesSnaps[c].eq(0).hasClass("active")&&this.linesSnaps[c].eq(0).is(":visible")?f+"l":f+"0",f=this.linesSnaps[c].eq(1).hasClass("active")&&this.linesSnaps[c].eq(1).is(":visible")?f+"r":f+"0",f=c<this.lines.length&&this.lines[c+1].isEmpty()&&this.$bottom_snap.hasClass("active")||
c<this.lines.length&&!this.lines[c+1].isEmpty()&&this.bottomSnaps[c].hasClass("active")?f+"b":f+"0",b=b+(f+'"]'),f=this.lines[c].getOrderedModules(),d=0;a.each(f,a.proxy(function(c,a){var e=this.modules[a],f=0;d!=e.column&&(f=e.column-d);b+=e.getHtml(f);d=e.column+e.size},this));e||(b+="[/row]")}}a("#content").val(b);console.log(b);return!0},save_page:function(){var b=this.save_input.val();this.confirm_lightbox=new w("Confirm Save",builderPath,a.proxy(this.save_confirmed,this),500,"No","Yes, I'm sure!");
this.saved_pages.hasOwnProperty(b)?this.confirm_lightbox.addContent("<p>Are you sure you want to save this page and <strong>replace</strong> the existing "+b+" page template?</p>"):this.confirm_lightbox.addContent("<p>Are you sure you want to save this page template as "+b+"?</p>");return!1},save_confirmed:function(){this.confirm_lightbox.switchLoading("Saving Template");title=this.save_input.val();this.makeHtml();jQuery.post(adminAjax,{action:"pq_save_page_template",title:title,content:a("#content").val()},
a.proxy(function(b){this.saved_pages.hasOwnProperty(title)||this.add_new_page_template_button(title);this.saved_pages[title]=a("#content").val();this.confirm_lightbox.closeEdit()},this))},add_new_page_template_button:function(b){0==this.number_saved_pages&&this.$loadModuleMenu.html("");a('<div href="#" data-rel="'+b+'" onclick="return false;">'+b+'<a class="remove_saved" href="#"></a></div>').appendTo(this.$loadModuleMenu).click(a.proxy(this.load_page,this));this.number_saved_pages++},load_page:function(b){b=
a(b.target);b.hasClass("remove_saved")?(this.to_remove_title=b=b.parent().attr("data-rel"),this.confirm_lightbox=new w("Confirm Saved Page Remove",builderPath,a.proxy(this.template_remove_confirmed,this),500,"No","Yes, I'm sure!"),this.confirm_lightbox.addContent("<p>Are you sure you want to <strong>remove</strong> the "+b+" page template?</p>")):(this.to_load_title=b=b.attr("data-rel"),this.confirm_lightbox=new w("Confirm Load",builderPath,a.proxy(this.load_confirmed,this),500,"No","Yes, I'm sure!"),
this.confirm_lightbox.addContent("<p>Are you sure you want to load "+b+" page template? <strong>This will erase everything you have on your page now!</strong></p>"));return!1},load_confirmed:function(){this.confirm_lightbox.closeEdit();this.clearAll();a("#content").val(this.saved_pages[this.to_load_title]);this.fromHtml()},template_remove_confirmed:function(){this.confirm_lightbox.switchLoading("Removing Template");jQuery.post(adminAjax,{action:"pq_remove_page_template",title:this.to_remove_title},
a.proxy(function(b){this.$loadModuleMenu.find('div[data-rel="'+this.to_remove_title+'"]').remove();this.confirm_lightbox.closeEdit();this.number_saved_pages--;0==this.number_saved_pages&&this.$loadModuleMenu.html("<p>No saved pages to load!</p>")},this))},getCenteredRelativeGridPosition:function(b,c,a){c=this.getGridPos(b,c);b=c.line;c=Math.round(c.column-a/2);0>c&&(c=0);12<c+a&&(c=12-a);return{column:c,line:b}},createModuleFinal:function(b){a(b.target).unbind("moduleButtonMove");a(b.target).unbind("moduleButtonUp");
if("module"==this.type)-1!=this.targetPlaceholder&&(this.modules[this.targetPlaceholder].addComponent(this.module),this.module.build(),a(this.module).bind("moduleDown",a.proxy(this.componentDown,this))),this.checkNumLines(),this.correctGrid();else{for(b=0;b<this.sizes.length;b++)this.placeholders[b].show(),this.lines[this.currentLine].addModule(this.placeholders[b]),a(this.placeholders[b]).bind("moduleDown",a.proxy(this.placeholderDown,this)),a(this.placeholders[b]).bind("moduleDelete",a.proxy(this.placeholderDelete,
this)),a(this.placeholders[b]).bind("moduleResize",a.proxy(this.correctGrid,this)),a(this.placeholders[b]).bind("moduleDuplicateInsert",a.proxy(this.duplicateInsertGrid,this));this.checkNumLines();this.correctGrid();for(b=0;b<this.sizes.length;b++)this.placeholders[b].priority=0}return!1},createComponent:function(b,c){this.module=new s.Component(x[c]);this.type="module";this.targetPlaceholder=-1;a(b.target).bind("moduleButtonMove",a.proxy(this.movingComponentInit,this));a(b.target).bind("moduleButtonUp",
a.proxy(this.createModuleFinal,this))},processComponentMoving:function(b,c){if(-1!=b){if(this.targetPlaceholder!=b){var a=this.modules[b];-1!=this.targetPlaceholder&&this.modules[this.targetPlaceholder].cancelAbove();a.componentAbove(c);this.targetPlaceholder=b}}else-1!=this.targetPlaceholder&&this.modules[this.targetPlaceholder].cancelAbove(),this.targetPlaceholder=-1},movingComponentInit:function(b,c,a){c=this.getGridPos(c,a);c=this.hittedPlaceholder(c.line,c.column);this.processComponentMoving(c,
b.target.info.color)},duplicateInsertGrid:function(b,c){a(c).bind("moduleDown",a.proxy(this.componentDown,this));a("html, body").animate({scrollTop:c.$obj.offset().top+"px"},300)},componentDown:function(b,c){console.log("componentDown");this.targetPlaceholder=c;a(b.target).bind("moduleMove",a.proxy(this.movingComponent,this));a(b.target).bind("moduleUp",a.proxy(this.placeComponent,this));return!1},movingComponent:function(b,c,a){b=b.target;c=this.getGridPos(c,a);c=this.hittedPlaceholder(c.line,c.column);
var f=b.placeholder;-1!=c&&c!=f?this.processComponentMoving(c,b.info.color):(this.modules[b.placeholder].movingComponent(a,b.number),this.targetPlaceholder!=b.placeholder&&this.modules[this.targetPlaceholder].cancelAbove(),this.targetPlaceholder=b.placeholder);return!1},placeComponent:function(b){a(b.target).unbind("moduleMove");a(b.target).unbind("moduleUp");var c=b.target.placeholder;-1!=this.targetPlaceholder&&this.targetPlaceholder!=c&&(this.modules[c].removeComponent(b.target.number),this.modules[this.targetPlaceholder].addComponent(b.target));
return!1},movingPlaceholdersBlock:function(b,c){if(b!=this.currentLine||c!=this.currentColumn){this.currentColumn=c;this.currentLine=b;for(var a=0;a<this.sizes.length;a++)this.$spotlight=this.placeholders[a].$obj,this.updateSpotlight(),this.placeholders[a].column=this.currentColumn,this.currentColumn+=this.sizes[a]}},createPlaceholder:function(b,c,e,f,d){this.placeholders=[];this.combinedSize=0;this.sizes=c;this.size=e;f=this.getCenteredRelativeGridPosition(f,d,e);e=f.line;for(f=f.column;this.lines[e].isEmpty()&&
0!=e;)e--;this.currentColumn=this.currentLine=-1;for(d=0;d<c.length;d++)this.combinedSize+=c[d];12<f+this.combinedSize&&(f=12-this.combinedSize);for(d=this.combinedSize=0;d<c.length;d++){var g=new s.Placeholder(c[d],f+this.combinedSize,this.modules.length);this.modules.push(g);this.placeholders.push(g);this.combinedSize+=c[d];g.$obj.appendTo(this.$viewHolder);g.$obj1.css("width",Math.round(this.$linesHolder.width()*(c[d]/12)-14)+"px")}this.type="placeholder";a(b.target).bind("moduleButtonMove",a.proxy(this.movingPlaceholderInit,
this));a(b.target).bind("moduleButtonUp",a.proxy(this.createModuleFinal,this));this.movingPlaceholdersBlock(e,f)},movingPlaceholderInit:function(b,c,a){c=this.getCenteredRelativeGridPosition(c,a,this.size);b=c.line;for(c=c.column;0<b&&this.lines[b-1].isEmpty();)b--;12<c+this.combinedSize&&(c=12-this.combinedSize);this.movingPlaceholdersBlock(b,c);return!1},placeholderDelete:function(b,c){this.lines[this.modules[c].line].removeModule(c);this.modules=removePositionInArray(this.modules,c);for(var a=
0;a<this.modules.length;a++)this.modules[a].number=a;this.correctGrid();this.checkNumLines()},placeholderDown:function(b,c,e,f){console.log("placeholderDown");this.initialLine=e;this.initialColumn=f;this.currentLine=e;this.currentColumn=f;this.moduleDragging=c;this.modules[c].priority=2;this.$spotlight=a("<div class='placeholderModule' style='position:absolute;'></div>").css("width",this.modules[c].$obj.width()-14).appendTo(this.$viewHolder);this.updateSpotlight();a(b.target).bind("moduleMove",a.proxy(this.movingPlaceholder,
this));a(b.target).bind("moduleUp",a.proxy(this.placePlaceholder,this));return!1},updateSpotlight:function(){var b=this.lines[this.currentLine].getOffsetY()-this.$viewHolder.offset().top,c=15+this.$viewHolder.width()/12*this.currentColumn,a=this.lines[this.currentLine].holder.height()-3;this.$spotlight.css({top:b+"px",left:c+"px",height:a+"px"})},movingPlaceholder:function(b,c,a){c=this.getGridPos(c,a);b=c.line;c=c.column;a=this.modules[this.moduleDragging];for(12<c+a.size&&(c=12-a.size);0<b&&(this.lines[b-
1].isEmpty()||this.lines[b].isEmpty()&&this.lines[b-1].hasOnly(a));)b--;if(b!=this.currentLine||c!=this.currentColumn)this.currentLine=b,this.currentColumn=c,this.updateSpotlight(),a.column=this.currentColumn;return!1},placePlaceholder:function(b){a(b.target).unbind("moduleMove");a(b.target).unbind("moduleUp");b=this.modules[this.moduleDragging];this.currentLine!=this.initialLine&&(this.lines[this.initialLine].removeModule(this.moduleDragging),this.lines[this.currentLine].addModule(b));this.currentColumn!=
this.initialColumn&&(b.column=this.currentColumn);this.$spotlight.remove();this.correctGrid();this.modules[this.moduleDragging].priority=0;this.moduleDragging=-1;return!1},createPageBreak:function(){for(var b=this.lines.length;this.lines[b-1].isEmpty()&&0!=b-1;)b--;var c=new s.Pagebreak(b,this.modules.length);this.modules.push(c);this.lines[b].addModule(c);a(c).bind("moduleDown",a.proxy(this.placeholderDown,this));a(c).bind("moduleDelete",a.proxy(this.placeholderDelete,this));this.checkNumLines();
this.correctGrid();return!1},checkIntersection:function(b){for(var c=0;c<this.modules.length;c++)if(this.modules[c].line==b)return!0;return!1},resolveIntersection:function(b){for(var c=0;c<b;){if(this.lines[c].isEmpty()){for(var a=0;a<this.modules.length;a++)this.modules[a].line==b&&this.modules[a].changeLine(c);return}c++}c=b;this.checkIntersection(c+1)&&this.resolveIntersection(c+1);for(a=0;a<this.modules.length;a++)this.modules[a].line==c&&this.modules[a].changeLine(c+1)},hittedPlaceholder:function(b,
c){for(var a=0;a<this.modules.length;a++)if("placeholder"==this.modules[a].type&&this.modules[a].line==b&&c>=this.modules[a].column&&c<this.modules[a].column+this.modules[a].size)return a;return-1},onScroll:function(){var b=a(window).scrollTop();this.menuFromTop=this.$pageBuilderTab.offset().top;var c=this.menuFromTop+this.$pageBuilderTab.height()-this.menuFromTop;b-this.menuFromTop+this.menuOffTop<c&&(b>this.menuFromTop-this.menuOffTop?this.$pageBuilderMenu.css({top:b-this.menuFromTop+this.menuOffTop+
"px"}):this.$pageBuilderMenu.css({top:"0px"}))},clearAllClick:function(){this.clear_all_lightbox=new w("Confirm Clear All",builderPath,a.proxy(this.clearAll,this),500,"No","Yes, I'm sure!");this.clear_all_lightbox.addContent("<p>Are you sure you want to clear all modules and placeholders on this page? This action doesn't have undo!</p>");return!1},clearAll:function(){for(var b=0;b<this.modules.length;b++)this.modules[b].removeQuick();this.modules=[];for(b=0;b<this.lines.length;b++)this.lines[b].modules=
[];this.correctGrid();this.checkNumLines();void 0!==this.clear_all_lightbox&&(this.clear_all_lightbox.closeEdit(),this.clear_all_lightbox=void 0);return!1},currentOverLine:function(b,c){this.lineOver=c;return!1},addLine:function(){var b=new E.newLine(this.$linesHolder,this.lines.length,this.$baseLine),c=a("<a href='#' class='snap_button to_left' data-snap='"+this.lines.length+"'></a>").appendTo(this.$view).click(this.snap_click),e=a("<a href='#' class='snap_button to_right' data-snap='"+this.lines.length+
"'></a>").appendTo(this.$view).click(this.snap_click);new Tooltip(c,"Snap row to the left",builderPath);new Tooltip(e,"Snap row to the right",builderPath);var f=a("<a href='#' class='snap_button vertical' data-snap='"+this.lines.length+"'></a>").appendTo(b.baseline).click(this.snap_click);new Tooltip(f,"No margin between these 2 rows",builderPath);a(b).bind("overThis",a.proxy(this.currentOverLine,this));this.lines.push(b);this.linesSnaps.push(c.add(e));this.bottomSnaps.push(f);this.correctGrid()},
snap_click:function(){var b=a(this);b.hasClass("active")?b.removeClass("active"):b.addClass("active");return!1},removeLine:function(){},correctGrid:function(){a.each(this.lines,a.proxy(function(b,c){var a=c.organize();a&&0<a.length&&(0!=b&&this.lines[b-1].isEmpty()?(this.lines[b-1].pushModules(a),this.lines[b-1].organize()):this.lines[b+1].pushModules(a));a=c.getOffsetY()-this.$view.offset().top+c.holder.height()/2-13;this.linesSnaps[b].css("top",a+"px");b==this.lines.length-1||c.isEmpty()||this.lines[b+
1].isEmpty()?this.bottomSnaps[b].hide():this.bottomSnaps[b].show();c.isEmpty()?this.linesSnaps[b].hide():(0==c.getModulesInColumn(0).length?this.linesSnaps[b].eq(0).hide():this.linesSnaps[b].eq(0).show(),c.hasColumnInEnd()?this.linesSnaps[b].eq(1).show():this.linesSnaps[b].eq(1).hide())},this));this.clearBlankLines();this.checkNumLines()},clearBlankLines:function(){for(var b=0;b<this.lines.length;b++)this.lines[b].isEmpty()&&this.pushAllTop(b+1)},pushAllTop:function(b){if(0!=b)for(;b<this.lines.length;b++){var c=
this.lines[b].popModules();this.lines[b-1].pushModules(c);this.lines[b-1].organize();this.lines[b].organize()}},checkNumLines:function(){var b=0;a.each(this.lines,function(c,a){a.isEmpty()&&b++});if(1>=b)this.addLine();else for(;2<b;)this.removeLine(),b--},getNumberEmptyLines:function(){for(var b=0,c=0;c<this.modules.length;c++)this.modules[c].line>b&&(b=this.modules[c].line);return gridLines.length-(b+1)},getGridPos:function(b,c){var a=this.$linesHolder.offset();b-=a.left;a=this.$linesHolder.width();
a=Math.round(12*(b/a));0>a?a=0:10<a&&(a=10);for(var f=this.lines.length-1,d=1;d<this.lines.length;d++)if(c<this.lines[d].getOffsetY()){f=d-1;break}return{column:a,line:f}},getPriorityRow:function(){var b=0,a=0,e=[];this.getModulesFromLine(b);var f=0,d=0;do{var g=this.getModulesHittingPos(a,b);if(0!=g.length){if(1==g.length)if(g[0]==this.moduleDragging)addIfDoesnExist(g[0],e);else{var l=this.modCollidesWithDrag(g[0]);if(-1==l)addIfDoesnExist(g[0],e);else{var h=this.modules[g[0]].size;d>=h?(addIfDoesnExist(g[0],
e),d-=h):(f>=h-l||addIfDoesnExist(this.moduleDragging,e),addIfDoesnExist(g[0],e))}}else for(;0!=g.length;){var l=this.getHighestPriority(g),p=g[l],g=removePositionInArray(g,l);p==this.moduleDragging&&0<g.length&&(l=this.getHighestPriority(g),h=this.modules[g[l]].size,d>=h?(addIfDoesnExist(g[l],e),g=removePositionInArray(g,l),d-=h):f>=h&&(addIfDoesnExist(g[l],e),g=removePositionInArray(g,l),f-=h));addIfDoesnExist(p,e)}f=0}else f++;a++;12==a&&(a=0,b++,this.getModulesFromLine(b),d=f,f=0)}while(e.length!=
this.modules.length);return e},getHighestPriority:function(b){for(var a=0;a<b.length;a++)if(b[a]==this.moduleDragging)return a;for(var e=20,f=-1,a=0;a<b.length;a++)this.modules[b[a]].column<e&&(e=this.modules[b[a]].column,f=a);return f},modCollidesWithDrag:function(a){if(-1==this.moduleDragging)return-1;var c=this.modules[this.moduleDragging];a=this.modules[a];return c.line==a.line&&c.column>=a.column&&c.column<a.column+a.size?c.column-a.column:-1},getModulesFromLine:function(b){var c=[];a.each(this.modules,
function(a,f){f.line==b&&c.push(f)});return c},getModulesHittingPos:function(b,c){var e=[];a.each(this.modules,function(a,d){d.line==c&&d.column==b&&e.push(a)});return e}};return z});
