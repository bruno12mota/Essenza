define(["jquery"],function(){var p=function(a,c,d,h,k,f,e,g){this.$elem=a;this.rate=30;this.width=c;this.height=d;this.originalRatio=e;this.isFullscreen=g;this.imageOriginalWidth=h;this.imageOriginalHeight=k;this.numIteration=0;this.resizeImage();this.parameters=f;this.numIterations=Math.round(1E3*this.parameters.kbDuration/this.rate)};p.prototype={start:function(){"image"==this.parameters.backgroundType&&(this.getTransformValues(0),this.parameters.useKenBurns&&(clearInterval(this.interval),this.interval=
setInterval($.proxy(this.iteration,this),this.rate)))},stop:function(){clearInterval(this.interval)},getTransformValues:function(a){var c=this.width,d=this.height,h=this.height/this.width,k="none"==this.parameters.horizontal_snapping&&"none"==this.parameters.vertical_snapping;this.isFullscreen&&!k&&(this.originalRatio<h?c=d/this.originalRatio:d=c*this.originalRatio);var f=c/parseFloat(this.parameters.kbStartSize,10)/this.imageWidth,e=d/parseFloat(this.parameters.kbStartSize,10)/this.imageHeight,f=
Math.max(f,e),e=c-this.imageWidth*f,g=d-this.imageHeight*f,e=parseFloat(this.parameters.kbStartLeft,10)*e,g=parseFloat(this.parameters.kbStartTop,10)*g;if(this.isFullscreen&&!k)if(this.originalRatio<h)var b=this.width-c,e=e+("left"==this.parameters.horizontal_snapping?0:"center"==this.parameters.horizontal_snapping?b/2:b);else this.originalRatio>h&&(b=this.height-d,g+="top"==this.parameters.vertical_snapping?0:"center"==this.parameters.vertical_snapping?b/2:b);if(this.parameters.useKenBurns){this.numIteration=
a;var m=Math.max(c/this.parameters.kbEndSize/this.imageWidth,d/this.parameters.kbEndSize/this.imageHeight),l=c-this.imageWidth*m,b=d-this.imageHeight*m,l=parseFloat(this.parameters.kbEndLeft,10)*l,n=parseFloat(this.parameters.kbEndTop,10)*b;this.isFullscreen&&!k&&(this.originalRatio<h?(b=this.width-c,l+="left"==this.parameters.horizontal_snapping?0:"center"==this.parameters.horizontal_snapping?b/2:b):this.originalRatio>h&&(b=this.height-d,n+="top"==this.parameters.vertical_snapping?0:"center"==this.parameters.vertical_snapping?
b/2:b));this.scaleIt=(m-f)/this.numIterations;this.transXIt=(l-e)/this.numIterations;this.transYIt=(n-g)/this.numIterations}else this.transYIt=this.transXIt=this.scaleIt=0;this.currentScale=f+this.scaleIt*a;this.currentTransX=e+this.transXIt*a;this.currentTransY=g+this.transYIt*a;this.transform()},iteration:function(){this.currentScale+=this.scaleIt;this.currentTransX+=this.transXIt;this.currentTransY+=this.transYIt;this.transform();++this.numIteration>=this.numIterations&&clearInterval(this.interval)},
transform:function(){Modernizr.csstransforms?this.$elem.setTransform("rotate(0.01deg) translate("+this.currentTransX+"px,"+this.currentTransY+"px) scale("+this.currentScale+")"):this.$elem.setIETransform({scale:this.currentScale,translateX:this.currentTransX,translateY:this.currentTransY})},resizeImage:function(){var a=this.width/this.imageOriginalWidth;this.imageWidth=this.imageOriginalWidth*a;this.imageHeight=this.imageOriginalHeight*a;this.imageHeight<this.height&&(a=this.height/this.imageOriginalHeight,
this.imageWidth=this.imageOriginalWidth*a,this.imageHeight=this.imageOriginalHeight*a);this.$elem.css({width:this.imageWidth+"px",height:this.imageHeight+"px"})},resize:function(a,c){this.width=a;this.height=c;this.resizeImage();this.getTransformValues(this.numIteration);this.transform()}};return p});
