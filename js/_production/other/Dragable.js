define(["jquery","jquery/jquery.mobile.vmouse","jquery/jquery.mousewheel.min","utils/utils"],function(b){var e=function(a,c,f,d){this.$target=c;this.$holder=a;this.verticaly=f;this.horizontaly=d;this.$scrollbar=a.find(".scrollbar");this.hasScrollbar=0<this.$scrollbar.length;this.$holder.bind(mouseDownBind,b.proxy(this.dragDown,this));this.hasScrollbar&&(this.$scroller=this.$scrollbar.find(">a"),this.$scrollbar.bind(mouseDownBind,b.proxy(this.scrollerDragDown,this)));this.$holder.bind("mousewheel",
b.proxy(this.mouseWheel,this));b(window).resize(b.proxy(this.resize,this));this.resize()};e.prototype={resize:function(){this.verticaly&&(this.currentHeight=this.$target.outerHeight(),this.holderHeight=this.$holder.height(),this.heightDiference=this.currentHeight-this.holderHeight);this.horizontaly&&(this.currentWidth=this.$target.outerWidth(),this.holderWidth=this.$holder.width(),this.widthDiference=this.currentWidth-this.holderWidth);if(this.hasScrollbar){var a=this.holderHeight/this.currentHeight,
c=this.$scrollbar.height(),a=this.$scrollbar.height()*a;this.$scroller.css("height",a+"px");this.scrollbarDif=c/this.currentHeight}this.verticaly&&this.currentHeight<=this.holderHeight&&this.enabled?(this.enabled=!1,this.remove()):this.enabled||(this.enabled=!0,this.rebind())},mouseWheel:function(a,c){this.currentTop=parseInt(this.$target.css("top"),10);this.currentLeft=parseInt(this.$target.css("left"),10);this.change(this.currentTop+13*c,this.currentLeft)},dragDownCommon:function(a){this.iniX=a.pageX;
this.iniY=a.pageY;this.currentTop=parseInt(this.$target.css("top"),10);this.currentLeft=parseInt(this.$target.css("left"),10);isNaN(this.currentTop)&&(this.currentTop=0);isNaN(this.currentLeft)&&(this.currentLeft=0);this.resize()},scrollerDragDown:function(a){this.dragDownCommon(a);b(document).bind(mouseMoveBind,b.proxy(this.scrollerDragMove,this));b(document).bind(mouseUpBind,b.proxy(this.dragUp,this));return!1},dragDown:function(a){this.dragDownCommon(a);b(document).bind(mouseMoveBind,b.proxy(this.dragMove,
this));b(document).bind(mouseUpBind,b.proxy(this.dragUp,this));return!1},scrollerDragMove:function(a){var c=this.iniX-a.pageX;a=(this.iniY-a.pageY)/this.scrollbarDif;this.change(this.currentTop+(this.verticaly?a:0),this.currentLeft+(this.horizontaly?c:0));return!1},dragMove:function(a){var c=this.iniX-a.pageX;a=this.iniY-a.pageY;this.change(this.currentTop-(this.verticaly?a:0),this.currentLeft-(this.horizontaly?c:0));return!1},dragUp:function(){unbindMoveAndUp();return!1},change:function(a,c){this.enabled&&
(this.verticaly&&(0<a&&(a=0),a<-this.heightDiference&&(a=-this.heightDiference)),this.horizontaly&&(c+this.currentWidth>this.limitRight&&(c=this.limitRight-this.currentWidth),c<this.limitLeft&&(c=this.limitLeft)),this.$target.css({top:a+"px",left:c+"px"}),this.hasScrollbar&&this.$scroller.css({top:-a*this.scrollbarDif+"px"}),this.$target.trigger("drag",{top:a,left:c}))},changeLimits:function(a,c,b,d){this.limitTop=a;this.limitRight=c;this.limitBottom=b;this.limitLeft=d},rebind:function(){this.currentHeight<=
this.holderHeight?this.enabled=!1:(this.remove(!0),this.$holder.bind(mouseDownBind,b.proxy(this.dragDown,this)),this.hasScrollbar&&this.$scrollbar.bind(mouseDownBind,b.proxy(this.scrollerDragDown,this)),this.$holder.bind("mousewheel",b.proxy(this.mouseWheel,this)))},remove:function(a){this.$holder.unbind(mouseDownBind);this.hasScrollbar&&this.$scrollbar.unbind(mouseDownBind);this.$holder.unbind("mousewheel",b.proxy(this.mouseWheel,this));!0!==a&&(this.$target.css({top:"0px",left:"0px"}),this.$scroller.css({top:"0px"}))}};
return e});
