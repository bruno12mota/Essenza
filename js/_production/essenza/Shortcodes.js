define(["jquery","essenza/MusicPlayer","utils/utils"],function(c,l){function s(){c(".blog_gallery").each(function(){var a=c(this),b=a.width(),d=a.find(">a"),g=parseInt(a.attr("data-width"),10),a=parseInt(a.attr("data-height"),10),f=Math.floor(b/g);b-f*g>f&&(b=Math.floor(b/(f+1))-1,d.css({width:b+"px",height:Math.round(b/(g/a))+"px"}))})}var B=function(a){jQuery(document).ready(c.proxy(function(b){this.current=-1;this.$contents=b(".tabs-content",a);this.$titles=b(".tabs-titles",a);this.tabs=[];b(".tab",
this.$contents).each(b.proxy(function(a,c){this.tabs.push(new A(b(c)))},this));this.links=[];b(">a",this.$titles).each(b.proxy(function(a,c){var f=b(c);f.attr("rel",a);f.click(b.proxy(this.tabClick,this));this.links.push(f)},this));this.changeTab(0)},this))};B.prototype={tabClick:function(a){a=parseInt(c(a.target).attr("rel"),10);this.changeTab(a);return!1},changeTab:function(a){-1!=this.current&&(this.tabs[this.current].close(),this.links[this.current].removeClass("active"));var b=this.tabs[a].open();
this.links[a].addClass("active");this.current=a;this.$contents.animate({height:b},150)}};var A=function(a){this.$tab=a;this.$tab.fadeTo(0,0);this.$tab.css({display:"none",opacity:0})};A.prototype={open:function(){this.$tab.stop().css("display","block").delay(150).fadeTo(150,1);return this.$tab.height()},close:function(){this.$tab.stop().fadeTo(150,0,function(){c(this).css("display","none")})}};var D=function(a){this.multiple=a.attr("data-multiple");this.elements=[];c("li",a).each(c.proxy(function(a,
d){this.elements.push(new C(c(d),a,c.proxy(this.changeTab,this)))},this))};D.prototype={changeTab:function(a){if("false"==this.multiple)for(var b=0;b<this.elements.length;b++)b!=a&&this.elements[b].close()}};var C=function(a,b,d){this.opened=!1;this.number=b;this.onOpen=d;this.iconNormal="fa-angle-down";this.iconActive="fa-angle-up";this.$head=c(">a",a);this.$content=c(">.content",a);this.$icon=c(">i",a);this.opened||this.$content.css("display","none");this.$head.click(c.proxy(this.toogle,this))};
C.prototype={close:function(){this.$content.is(":hidden")||this.$content.slideToggle(150,c.proxy(this.onHidingChange,this))},toogle:function(a){a.preventDefault();if(this.$content.is(":hidden"))this.onOpen(this.number);this.$content.not(":animated").slideToggle(150,c.proxy(this.onHidingChange,this));this.$icon.fadeTo(150,0);return!1},onHidingChange:function(){this.$content.is(":hidden")?(this.$head.removeClass("active"),this.$icon.removeClass(this.iconActive).addClass(this.iconNormal).fadeTo(150,
1)):(this.$head.addClass("active"),this.$icon.removeClass(this.iconNormal).addClass(this.iconActive).fadeTo(150,1));return!1}};var E=function(a){this.values=["Unchecked","Checked"];this.active=0;this.$checkbox=a;a.click(c.proxy(this.click,this));this.$active=this.$checkbox.find(".checkbox_inner");this.$input=this.$checkbox.find("input");this.update(!1)};E.prototype={update:function(a){var b=0,c=0;this.active&&(b=1);a&&(c=150);this.$active.fadeTo(c,b);this.$input.val(this.values[!0==this.active?1:
0])},click:function(){this.active=this.active?!1:!0;c(this).trigger("change");this.update(!0);return!1},val:function(a){if(void 0==a)return this.active?this.values[1]:this.values[0];this.active=a===this.values[1];this.update()},info:function(){return this.active.toString()}};var F=function(a){this.active=0;this.opened=!1;this.values=[];this.options=[];this.$combobox=a;this.$input=this.$combobox.find("input");a.css({width:150,"min-width":150});c(".combobox-option",a).each(c.proxy(function(a,d){var g=
c(d);this.options.push(g);g.attr("rel",a);this.hasOptions=!0;this.values.push(g.text())},this));this.$holder=this.$combobox.find(".combobox-holder");this.$selectedText=this.$combobox.find(".selected-text");this.$optionsHolder=this.$combobox.find(".combobox-options-holder");this.$closed_status=this.$combobox.find(".closed-status");this.$opened_status=this.$combobox.find(".opened-status");this.rebind();this.hasOptions?this.update(!1):(a.stop().fadeTo(200,0.7),this.$selectedText.text("no options"));
a.bind("changeOptions",c.proxy(this.changeOptions,this))};F.prototype={rebind:function(){this.$holder.click(c.proxy(this.click,this)).hover(c.proxy(this.interruptClose,this),c.proxy(this.closeDelay,this));for(var a=this,b=this.$combobox,d=0;d<this.options.length;d++)this.options[d].click(function(){a.active=parseInt(c(this).attr("rel"));a.update(!0);c(a).trigger("change");b.trigger("change")})},changeOptions:function(a,b,d,g){this.options=[];this.values=d;for(a=0;a<b.length;a++)d=c('<div class="combobox-option">'+
b[a]+"</div>").appendTo(this.$combobox),d.attr("rel",a),this.options.push(d);this.$options.remove();this.$options=c(".combobox-option",this.$combobox).remove();this.$options.appendTo(this.$optionsHolder);var f=this;for(a=0;a<this.options.length;a++)this.options[a].click(function(){f.active=parseInt(c(this).attr("rel"));f.update(!0);c(f).trigger("change");f.$combobox.trigger("change")});void 0!=g?this.val(g):this.update(!1)},update:function(a){var b=0;a&&(b=150);if(0>this.active||this.active>=this.options.length)this.active=
0;this.$selectedText.fadeTo(b,0,c.proxy(function(){this.$selectedText.html(this.options[this.active].html()).fadeTo(b,1)},this));this.$input.val(this.options[this.active].html());c(this).trigger("change")},open:function(){this.$holder.css({height:28+parseInt(this.$optionsHolder.height(),10)+"px"}).addClass("opened");this.$closed_status.hide();this.$opened_status.show();this.opened=!0},close:function(){this.$holder.css({height:"28px"}).removeClass("opened");this.$closed_status.show();this.$opened_status.hide();
this.opened=!1},closeDelay:function(){ismobile||(this.timer=setTimeout(c.proxy(this.close,this),300))},interruptClose:function(){ismobile||clearTimeout(this.timer)},click:function(){this.opened?this.close():this.open();return!1},val:function(a){if(void 0==a)return this.values[this.active];for(var b=0;b<this.values.length;b++)if(this.values[b]==a){this.active=b;this.update();break}},info:function(){return this.options[this.active]}};c(window).resize(function(){setTimeout(s,200)});var G=function(a,
b){var c=a.offset(),g=c.top,f=c.left,k=a.height(),e=a.width(),h="top",c="left";b.pageY>g+k/2?(h="bottom",verticalValue=g+k-b.pageY):verticalValue=b.pageY-g;b.pageX>f+e/2?(c="right",horizontalValue=f+e-b.pageX):horizontalValue=b.pageX-f;g=h;verticalValue>horizontalValue&&(g=c);return g},I=function(){function a(){m=b.width();t=b.height();if(m<u){b.css("height",Math.round(m/H));var a=m/u;f.setTransition("none");p.setTransform("scale("+a+", "+a+")")}else b.css("height",q),f.setTransition("none"),p.setTransform("scale(1, 1)");
f.height();f.setTransition(getTransition(x,y,z))}var b=c(this),d=parseFloat(b.data("shade_opacity"),10)/100,g=parseFloat(b.data("shade_over_opacity"),10)/100,f=b.find(">*"),k=b.find("div:first-child"),e=b.find(".ib_shader").css({display:"block",opacity:d}),h=b.find(".ib_over_image").css({display:"block",opacity:"0"}),p=b.find(".ib_over_text").css({display:"block",opacity:"0"}),u=parseFloat(b.data("width"),10),q=parseFloat(b.data("height"),10),H=u/q,r=b.data("transition"),x=b.data("transition_ease"),
y=b.data("transition_type"),z=b.data("transition_duration");f.setTransition(getTransition(x,y,z));var n=parseFloat(b.data("transition_ini_scale"),10)/100,v=b.data("transition_ini_rotation"),w=parseFloat(b.data("transition_scale"),10)/100,l=b.data("transition_rotation");"transformation"==r&&(h.setTransform("rotate("+v+"deg) scale("+n+", "+n+")"),k.setTransform("rotate("+v+"deg) scale("+n+", "+n+")"));var m,t;a();var s;c(window).resize(function(){clearTimeout(s);s=setTimeout(a,200)});c("html").hasClass("no-touch")&&
(b.unbind("hover"),b.hover(function(a){b.hasClass("disabled")||("mouse"==r||"mouseIn"==r?(f.setTransition("none"),f.height(),a=G(b,a),h.css("opacity","1"),"top"==a?h.css({top:-t+"px",left:"0px"}):"bottom"==a?h.css({top:t+"px",left:"0px"}):"left"==a?h.css({left:-m+"px",top:"0px"}):"right"==a&&h.css({left:m+"px",top:"0px"}),f.height(),f.setTransition(getTransition(x,y,z)),h.css({top:"0px",left:"0px"})):h.css("opacity","1"),"transformation"==r&&(h.setTransform("rotate("+l+"deg) scale("+w+", "+w+")"),
k.setTransform("rotate("+l+"deg) scale("+w+", "+w+")")),e.css("opacity",g),p.css("opacity",1))},function(a){b.hasClass("disabled")||("mouse"==r?(a=G(b,a),h.css("opacity","1"),"top"==a?h.css("top",-t+"px"):"bottom"==a?h.css("top",t+"px"):"left"==a?h.css("left",-m+"px"):"right"==a&&h.css("left",m+"px")):h.css("opacity","0"),"transformation"==r&&(h.setTransform("rotate("+v+"deg) scale("+n+", "+n+")"),k.setTransform("rotate("+v+"deg) scale("+n+", "+n+")")),e.css("opacity",d),p.css("opacity",0))}))};newPqButton=
function(){var a=c(this),b=a.data("background"),d=parseFloat(a.data("background_alpha"),10)/100,g=a.data("background_over"),f=parseFloat(a.data("background_alpha_over"),10)/100,k=a.data("color"),e=a.data("color_over"),h=a.data("border"),p={"border-color":a.data("border_over"),color:e},u={"border-color":h,color:k},k=a.data("tween_time"),e=a.data("tween");a.processColorAndPattern(b,d);a.addEaseAll(k,e,["border-color","color","background-color"]);a.unbind("hover");a.hover(function(){a.hasClass("disabled")||
(a.css(p),a.processColorAndPattern(g,f))},function(){a.hasClass("disabled")||(a.css(u),a.processColorAndPattern(b,d))})};return runShortcodes=function(){var a=c(".with_sidebar");if(0<a.length){var b=a.height();a.find(".content_wraper").height();var d=a.find(".sidebar .row-fluid").height();d>b&&a.find(".content_wraper").height(d+"px")}c(".social_video").each(function(){function a(){e.height(Math.round(e.parent().width()*h))}function b(){$close_btn=e.find(".close_button").unbind("click");e.find("iframe, .close_button").remove();
e.find("a, div, img").show()}function k(){var a=e.data("src"),a=c('<iframe src="'+a+'" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'),g=c('<a class="close_button" onclick="return false;" href="#"><div class="close_ico inside_icon"></div></a>').click(b);e.find("a, div, img").hide();e.append(a);e.append(g)}var e=c(this),h=parseFloat(e.data("height"),10)/100;a();var d;c(window).resize(function(){clearTimeout(d);d=setTimeout(a,200)});e.bind("gridResize",
a);void 0!=e.data("src")&&e.find(".tooglePlayVideo").click(k)});c(".form_shortcode").each(function(){var a=c(this);a.find(".button").click(function(){a.submit();return!1});a.submit(function(){if(!a.hasClass("busy")){var b=a.find(".on_error"),d=!0;a.find("input, textarea").each(function(a,g){$input=c(g);var e=$input.attr("type");if("hidden"!=e){var q=$input.attr("data-required"),l=$input.val();"true"==q&&""==l?(b.slideDown(250),d=!1):"true"!=q&&("false"!=q||"email"!=e||""==l)||("email"!=e||RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(l))||
(b.slideDown(250),d=!1)}});if(d){a.addClass("busy");b.is(":hidden")||b.slideUp(250);var e=a.serialize(),e=e+"&action=pq_send_email";a.find(".button").fadeTo(300,0.4).trigger("mouseout").addClass("disabled");c.post(adminAjax,e,function(b,c){"1"!=b&&1!=b||"success"!=c?a.find(".on_error").slideDown(250):(a.find(".on_success").slideDown(250),a.find("input, textarea").val(""));a.removeClass("busy");a.find(".button").fadeTo(300,1).removeClass("disabled")})}}return!1})});c(".tabs").each(function(){new B(c(this))});
c(".checkbox").each(function(){new E(c(this))});c(".combobox").each(function(){new F(c(this))});c(".accordion").each(function(){new D(c(this))});s();c(".pq_button").each(newPqButton);c(".image_button").each(I);c(".music_player").each(function(){var a=c(this),b=a.data("url");"sound"==a.data("type")?new l(a,b):c.getJSON("http://api.soundcloud.com/resolve?url="+b+"&format=json&consumer_key=6c786345f5161898f1e1380802ce9226&callback=?",function(b){WP_DEBUG&&console.log(b);b=b.stream_url;-1==b.indexOf("secret_token")?
b+="?":b+="&";new l(a,b+"consumer_key=6c786345f5161898f1e1380802ce9226")})})}});
